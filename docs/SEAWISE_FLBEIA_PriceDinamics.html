<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marga Andrés">
<meta name="author" content="Miren Altuna-Etxabe">
<meta name="author" content="Affilation: AZTI">
<meta name="dcterms.date" content="2025-01-09">

<title>SEAWISE_FLBEIA_PriceDynamics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/clipboard/clipboard.min.js"></script>
<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/popper.min.js"></script>
<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/anchor.min.js"></script>
<link href="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SEAWISE_FLBEIA_PriceDinamics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SEAWISE_FLBEIA_PriceDinamics_files/libs/bootstrap/bootstrap-813c323200a87c37e262811031999de4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #4097C2;
      }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light">

<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">SEAWISE_FLBEIA_PriceDynamics</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Authors</div>
      <div class="quarto-title-meta-contents">
               <p>Marga Andrés </p>
               <p>Miren Altuna-Etxabe </p>
               <p>Affilation: AZTI </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 9, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> INTRODUCTION</a></li>
  <li><a href="#price-functions-in-flbeia" id="toc-price-functions-in-flbeia" class="nav-link" data-scroll-target="#price-functions-in-flbeia"><span class="header-section-number">2</span> PRICE FUNCTIONS IN FLBEIA</a>
  <ul class="collapse">
  <li><a href="#price-model-type-1" id="toc-price-model-type-1" class="nav-link" data-scroll-target="#price-model-type-1"><span class="header-section-number">2.1</span> Price model Type 1</a></li>
  <li><a href="#price-model-type-2" id="toc-price-model-type-2" class="nav-link" data-scroll-target="#price-model-type-2"><span class="header-section-number">2.2</span> Price model Type 2</a></li>
  <li><a href="#price-model-type-3" id="toc-price-model-type-3" class="nav-link" data-scroll-target="#price-model-type-3"><span class="header-section-number">2.3</span> Price model Type 3</a></li>
  <li><a href="#price-model-type-4" id="toc-price-model-type-4" class="nav-link" data-scroll-target="#price-model-type-4"><span class="header-section-number">2.4</span> Price model Type 4</a></li>
  </ul></li>
  <li><a href="#price-model-selection" id="toc-price-model-selection" class="nav-link" data-scroll-target="#price-model-selection"><span class="header-section-number">3</span> PRICE MODEL SELECTION</a></li>
  <li><a href="#parameterization-for-simulations" id="toc-parameterization-for-simulations" class="nav-link" data-scroll-target="#parameterization-for-simulations"><span class="header-section-number">4</span> PARAMETERIZATION FOR SIMULATIONS</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">5</span> REFERENCES</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="quarto-figure quarto-figure-top">
<figure class="figure">
<p><a href="https://seawiseproject.org/"><img src="logo.png" class="img-fluid quarto-figure quarto-figure-top figure-img" width="100"></a></p>
</figure>
</div>
<p><a href="https://seawiseproject.org/" title="SEAWISE">Link to SEAWISE web</a> <a href="https://github.com/ices-tools-dev/SEAwise">Link to SEAWISE Github</a></p>
<section id="introduction" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">1</span> INTRODUCTION</h2>
<p>This document describes the code used to integrate new price dynamics into FLBEIA simulations, based on the approach developed in the SEAWISE project. The process was carried out in several key steps:</p>
<ol type="1">
<li><p><strong>Price functions in FLBEIA</strong><br>
A comprehensive collection of candidate price functions was compiled for consideration, and how it is coded within FLBEIA.</p></li>
<li><p><strong>Price model selection</strong><br>
A systematic method was developed to evaluate and select the most appropriate price dynamics model.</p></li>
<li><p><strong>Parameterization for simulations</strong><br>
Guidance is provided on how to include the parameterization of price dynamics in the model setup to enable realistic simulations.</p></li>
</ol>
<p>The aim of this document is to explain how price dynamics can be integrated into simulations using FLBEIA. The code provided is not intended for execution, but rather to illustrate how price functions are parameterized and how they operate within the FLBEIA framework.</p>
</section>
<section id="price-functions-in-flbeia" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="price-functions-in-flbeia"><span class="header-section-number">2</span> PRICE FUNCTIONS IN FLBEIA</h2>
<p>The price of a species can be influenced by both exogenous factors (e.g., changes in imports) and endogenous factors (e.g., variations in landings or average size). In FLBEIA, only price functions dependent on endogenous variables are considered, as exogenous factors remain constant within the model framework.&nbsp; Before SEAWISE project, in FLBEIA were two price functions implemented:</p>
<ul>
<li>Fixed Price: The prices are given as input data and are unchanged within the simulation.<br>
</li>
<li>Elastic Price - Type 1: This function implements the price function used in [Kraak et al., 2004](https://www.ices.dk/sites/pub/CM%20Doccuments/2004/D/WGMG04.pdf</li>
<li>Elastic Price at age - Type 1: This function implements the price function used in <a href="https://www.ices.dk/sites/pub/CM%20Doccuments/2004/D/WGMG04.pdf">Kraak et al., 2004</a> by considering the age.</li>
</ul>
<p>In SEAWISE <a href="https://data.dtu.dk/articles/online_resource/SEAwise_report_on_Carbon_footprint_economic_and_social_impacts_of_management_strategies/25012085?file=44083586">Deliverable 2.2.</a>, Section 3.1.1. presents several price functions to be included into <a href="https://github.com/flr/FLBEIA">FLBEIA</a> to enhance the modeling of price dynamics. In addition, an external factor that, for example, causes the price to increase by a fixed percentage each year has also been included as an option. The selected prices model that were included in FLBEIA are:</p>
<section id="price-model-type-1" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="price-model-type-1"><span class="header-section-number">2.1</span> Price model Type 1</h3>
<p>This type was already coded already implemented before SEAWISE. The function was defined from <em>Salz et al.&nbsp;(2011)</em> and is defined as:</p>
<p><span class="math display">\[
p_{s,f,t} = p_{s,f,0} \left( \frac{L_{s,f,t}}{L_{s,f,0}} \right)^{\varepsilon_{s,f}}
\
\]</span> where <em>s</em> is the species, <em>f</em> the fleet segment, <em>t</em> the time, <em>p</em> the price with the unit (€/kg), <em>L</em> the landing (in kg), <em>a</em> the age, <em>m</em> the metier and e <em>ε<sub>s,f</sub></em> is elasticity coefficient price-landings.</p>
</section>
<section id="price-model-type-2" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="price-model-type-2"><span class="header-section-number">2.2</span> Price model Type 2</h3>
<p>Modified with respect to Salz et al.&nbsp;(2011)*</p>
<p>The price function is defined as:</p>
<p><span class="math display">\[
p_{s,f,t} = p_{s,f,t-1} \left( \frac{L_{s,f,t}}{L_{s,f,t-1}} \right)^{\varepsilon_{s,f}}
\
\]</span></p>
<p>In the original version of Salz et al.&nbsp;(2011), the ratio was calculated against a base year using instead of previous year.</p>
</section>
<section id="price-model-type-3" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="price-model-type-3"><span class="header-section-number">2.3</span> Price model Type 3</h3>
<p>Price as a function of relative changes in landings The price function is defined as:</p>
<p><span class="math display">\[
p_{s,f,t} = p_{s,f,t-1} \left(1 + \varepsilon_{s,f} \cdot \frac{L_{s,f,t} - L_{s,f,t-1}}{L_{s,f,t-1}} \right)
\
\]</span></p>
</section>
<section id="price-model-type-4" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="price-model-type-4"><span class="header-section-number">2.4</span> Price model Type 4</h3>
<p>Price as a function of the current landings and is defined as:</p>
<p><span class="math display">\[
p_{s,f,t} = p_{s,f,t=last}^ \cdot e^{\varepsilon_{s,f}L_{s,f,t}}
\
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(p_{\text{s,f,t=last}}\)</span>: is the price in the last year of simulation (€/kg)<br>
</li>
<li><span class="math inline">\(\varepsilon_{s,f}\)</span>: is the elasticity coefficient for price–landings</li>
</ul>
<p>The FLBEIA team has enhanced the code to incorporate additional price dynamics, which can be applied at either the fleet or métier level. The price dynamics can also be defined considering the age of the fish, or without consider the age, i.e., the same function for all ages. The updated code is available <a href="https://github.com/flr/FLBEIA/blob/master/R/OM_2c_Price_Dynamics.R#L1:">here</a>, code that we briefly describe below:</p>
<p>Available Functions are divided in:&nbsp;</p>
<ol type="1">
<li><strong><code>fixedPrice</code></strong> where the price is provided as input and the function simply returns the object unchanged.<br>
</li>
<li><strong><code>elasticPrice</code></strong> in which the elasticity function that models the price use the same formula for all age groups.<br>
</li>
<li><strong><code>elasticPriceAge</code></strong>: Elasticity function that models the price using different formulas for each age group.<br>
</li>
</ol>
<p>The options for <code>elasticPrice</code> and <code>elasticPriceAge</code> are:<br>
- <code>total</code>determines how the price function is conditioned: <code>TRUE</code> is based on total landings and <code>FALSE</code> based on landings of the specific fleet landings.<br>
- <code>type</code>specifies the elasticity function to use: <code>type1</code> when price varies according to Kraak’s elasticity function (Kraak, 2004); <code>type2</code> when price varies according to Function 3 from Deliverable 2.2.; <code>type3</code> when the price varies according to Function 1 from Deliverable 2.2.; <code>type4</code>when the price varies according to Function 4 from Deliverable 2.2. and <code>type5</code> is equivalent to <code>fixedPrice</code>.&nbsp;</p>
<p>The argument <code>RP</code>allows you to adjust the calculated price by increasing or decreasing it by a specific percentage.</p>
<p>The following code is simply intended to explore how price functions are coded within FLBEIA and to understand their internal workings. It is not meant for model parameterization.</p>
<p>FIXED PRICE</p>
<div class="cell" data-fold="TRUE">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>fixedPrice <span class="ot">&lt;-</span> <span class="cf">function</span>(fleets, covars, fleets.ctrl, <span class="at">year =</span> <span class="dv">1</span>, <span class="at">season =</span> <span class="dv">1</span>,...){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fleets)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ELASTIC PRICE</p>
<div class="cell" data-fold="TRUE">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>elasticPrice <span class="ot">&lt;-</span> <span class="cf">function</span>(fleets, covars, fleets.ctrl, stnm, flnm, mtnm, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">year =</span> <span class="dv">1</span>, <span class="at">season =</span> <span class="dv">1</span>){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    fms      <span class="ot">&lt;-</span> fleets[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    fms.ctrl <span class="ot">&lt;-</span> fleets.ctrl[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> year</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> season</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    elsa     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.elsa'</span>]][,ss,,,]  <span class="co"># [na,it] Price-landing elasticity.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    La0      <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.La0'</span>]][,ss,,,]   <span class="co"># [na,it] Base landings.</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    Pa0      <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.Pa0'</span>]][,ss,,,]   <span class="co"># [na,it] Base price.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    type     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">"type"</span>]]             <span class="co"># [n,it]  Numeric vector </span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    total    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.total'</span>]]         <span class="co"># Logic:  If TRUE, the function</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># depends on total landings, and if FALSE on the landings </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># of the fleet in question.</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fms.ctrl[[<span class="st">'pd.RP'</span>]])){RP   <span class="ot">&lt;-</span> <span class="cn">FALSE</span>  </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># By default the price function does not have an added increase/decrease.</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{  </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      RP       <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.RP'</span>]]              </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Logic: If TRUE, the function has an added increase/decrease, </span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and if FALSE it does not.</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>      addRP    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.addRP'</span>]]                    </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Percentage of the price increased/decreased. Same for all ages.</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>      yr.addRP <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.yr'</span>]]          </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Numeric vector. The year from which the price starts increasing</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># or decreasing annually.</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Landings</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(total <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr,,ss]</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr<span class="dv">-1</span>,,ss] </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,,,ss] </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr,,ss]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr<span class="dv">-1</span>,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr<span class="dv">-1</span>,,ss]</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,,,ss]</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    La_f     <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau)[drop<span class="ot">=</span>T]</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    La_init  <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_init)[drop<span class="ot">=</span>T]</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    La_hist  <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_hist)[drop<span class="ot">=</span>T]</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Type</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">1</span>) { P <span class="ot">&lt;-</span> Pa0<span class="sc">*</span>(La0<span class="sc">/</span>La_f)<span class="sc">^</span>elsa }</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> type <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> type <span class="sc">==</span> <span class="dv">4</span>) {  </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>      els    <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(elsa)    <span class="co"># [n,it]</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>      L_f    <span class="ot">&lt;-</span> <span class="fu">sum</span>(La_f)           <span class="co"># [n,it]</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>      L_init <span class="ot">&lt;-</span> <span class="fu">sum</span>(La_init)        <span class="co"># [n,it]</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>      L_hist <span class="ot">&lt;-</span> <span class="fu">colSums</span>(La_hist)    <span class="co"># [n,it]</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>      P_init <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, yr<span class="dv">-1</span>, , ss])  <span class="co"># [n,it]</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(L_f <span class="sc">==</span> <span class="dv">0</span>){P <span class="ot">&lt;-</span> <span class="cn">NA</span>          <span class="co"># When L_f = 0 -&gt; set P = NA</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(L_init<span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>          L_hist[<span class="fu">is.na</span>(L_hist)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>          filtered_L <span class="ot">&lt;-</span> L_hist[L_hist <span class="sc">!=</span> <span class="dv">0</span>]       </span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Remove years with no landing data.</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>          Last_Lyr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">names</span>(filtered_L)))</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Identify the last year with landing != 0.</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>          L_init <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(L_hist[<span class="fu">names</span>(L_hist)<span class="sc">==</span> Last_Lyr])  </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Take the last landing != 0.</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>          P_init <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, <span class="fu">grepl</span>(Last_Lyr, <span class="fu">names</span>(L_hist)), , ss]) </span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Take the corresponding price data.</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>        } </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">2</span>){P <span class="ot">&lt;-</span> P_init<span class="sc">*</span>(L_f<span class="sc">/</span>L_init)<span class="sc">^</span>els}</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">3</span>){P <span class="ot">&lt;-</span> P_init<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>els<span class="sc">*</span>((L_f<span class="sc">-</span>L_init)<span class="sc">/</span>L_init))}</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">4</span>){P <span class="ot">&lt;-</span> P_init<span class="sc">*</span><span class="fu">exp</span>(els<span class="sc">*</span>L_f)}</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    P <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(P <span class="sc">==</span> <span class="cn">Inf</span>, <span class="cn">NA</span>, P)    <span class="co"># When L_f = 0 -&gt; P = Inf -&gt; set P = NA</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Added increase/decrease in Price.</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(RP <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>        yr.addRP.pos <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(La_hist) <span class="sc">%in%</span> yr.addRP) </span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Identify the position of the year from which the price starts increasing or decreasing annually.</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        nyr <span class="ot">&lt;-</span> yr<span class="sc">-</span>yr.addRP.pos<span class="sc">+</span><span class="dv">1</span>                </span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of years since the first year of the simulation.</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        P_data <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, <span class="dv">1</span><span class="sc">:</span>(yr<span class="dv">-1</span>), , ss]) </span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        P_data[<span class="fu">is.na</span>(P_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        filtered_P <span class="ot">&lt;-</span> P_data[P_data <span class="sc">!=</span> <span class="dv">0</span>]                 </span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove years with no price data.</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        Last_Pyr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">colnames</span>(filtered_P))) </span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Identify the last year with price data != 0.</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        yr.name <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">colnames</span>(La_hist)[yr])  </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Actual year</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        nyr <span class="ot">&lt;-</span> <span class="fu">length</span>(yr.name<span class="sc">:</span>Last_Pyr)<span class="sc">-</span><span class="dv">1</span>   </span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of years since the last price data.</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>addRP)<span class="sc">^</span>nyr</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    fms<span class="sc">@</span>price[, yr, , ss] <span class="ot">&lt;-</span> P </span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]] <span class="ot">&lt;-</span> fms</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fleets)</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>ELASTIC PRICE BY AGE</p>
<div class="cell" data-fold="TRUE">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>elasticPriceAge <span class="ot">&lt;-</span> <span class="cf">function</span>(fleets, covars, fleets.ctrl, stnm, flnm, mtnm, <span class="at">year =</span> <span class="dv">1</span>, <span class="at">season =</span> <span class="dv">1</span>){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    fms      <span class="ot">&lt;-</span> fleets[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    fms.ctrl <span class="ot">&lt;-</span> fleets.ctrl[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> year</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> season</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    elsa    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.elsa'</span>]][,ss,,,]<span class="co"># [na,it] Price-landing elasticity.</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    La0     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.La0'</span>]][,ss,,,] <span class="co"># [na,it] Base landings.</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    Pa0     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.Pa0'</span>]][,ss,,,] <span class="co"># [na,it] Base price.</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    type    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">"type"</span>]]           </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [na,it] Numeric vector: The type depend on age.</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    total   <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.total'</span>]] </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Logic: If TRUE, the function depends on total landings, and if FALSE on the landings of the fleet in question.</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fms.ctrl[[<span class="st">'pd.RP'</span>]]))    {RP   <span class="ot">&lt;-</span> <span class="cn">FALSE</span>  </span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># By default the price function does not have an added increase/decrease.</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{  </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      RP       <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.RP'</span>]]      </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Logic: If TRUE, the function has an added increase/decrease, </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and if FALSE it does not.</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      addRP    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.addRP'</span>]]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Percentage of the price increased/decreased. Same for all ages.</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      yr.addRP <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.yr'</span>]]  </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Numeric vector. The year from which the price starts increasing</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># or decreasing annually.</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Landings</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(total <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr,,ss]</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr<span class="dv">-1</span>,,ss] </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,,,ss] </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr,,ss]</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr<span class="dv">-1</span>,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr<span class="dv">-1</span>,,ss]</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,,,ss]</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    La_f    <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau)[drop<span class="ot">=</span>T]</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    La_init <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_init)[drop<span class="ot">=</span>T]</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    La_hist <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_hist)[drop<span class="ot">=</span>T]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    Pa_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>price[, yr<span class="dv">-1</span>, , ss]  <span class="co"># [na,it]</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Type</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fms<span class="sc">@</span>range[[<span class="st">"min"</span>]]<span class="sc">:</span>fms<span class="sc">@</span>range[[<span class="st">"max"</span>]])){</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>      tpa <span class="ot">&lt;-</span> type[a]  <span class="co"># Price function of age a</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">1</span>){Pa <span class="ot">&lt;-</span> Pa0[a]<span class="sc">*</span>(La0[a]<span class="sc">/</span>La_f[a])<span class="sc">^</span>elsa[a]</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(La_f[a] <span class="sc">==</span> <span class="dv">0</span>){Pa <span class="ot">&lt;-</span> <span class="cn">NA</span>   <span class="co"># When L_f = 0 -&gt; set P = NA</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(La_init[a]<span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>            La_hist[a,][<span class="fu">is.na</span>(La_hist[a,])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>            filtered_La <span class="ot">&lt;-</span> La_hist[a,][La_hist[a,] <span class="sc">!=</span> <span class="dv">0</span>]     </span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove years with no landing data.</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>            Last_Layr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">names</span>(filtered_La)))  </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Identify the last year with landing != 0.</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>            La_init <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(La_hist[,<span class="fu">colnames</span>(La_hist)<span class="sc">==</span> Last_Layr])   </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Take the last landing =! 0.</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>            Pa_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>price[, <span class="fu">grepl</span>(Last_Layr, <span class="fu">colnames</span>(La_hist)), , ss]</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Take the corresponding price data.</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">2</span>){Pa <span class="ot">&lt;-</span> Pa_init[a]<span class="sc">*</span>(La_f[a]<span class="sc">/</span>La_init[a])<span class="sc">^</span>elsa[a]} </span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">3</span>){Pa <span class="ot">&lt;-</span> Pa_init[a]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>elsa[a]<span class="sc">*</span>((La_f[a]<span class="sc">-</span>La_init[a])<span class="sc">/</span>La_init[a]))} </span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">4</span>){Pa <span class="ot">&lt;-</span> Pa_init[a]<span class="sc">*</span><span class="fu">exp</span>(elsa[a]<span class="sc">*</span>La_f[a])} </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">5</span>){Pa <span class="ot">&lt;-</span> elsa[a]}</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>      Pa <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( Pa<span class="sc">==</span><span class="cn">Inf</span>, <span class="cn">NA</span>, Pa)  <span class="co"># When La_f = 0 -&gt; Pa = Inf -&gt; set Pa = NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>INCREASE OR DECREASE THE PRICE OVER THE TIME SERIES OF THE SIMULATION</p>
<div class="cell" data-fold="TRUE">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(RP <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> tpa <span class="sc">==</span> <span class="dv">5</span>){</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>          yr.addRP.pos <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(La_hist) <span class="sc">%in%</span> yr.addRP)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Identify the position of the year from which the price starts</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>          <span class="co"># increasing or decreasing annually.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>          nyr <span class="ot">&lt;-</span> yr<span class="sc">-</span>yr.addRP.pos<span class="sc">+</span><span class="dv">1</span>    </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Number of years since the first year of the simulation.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>          P_data <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, <span class="dv">1</span><span class="sc">:</span>(yr<span class="dv">-1</span>), , ss]) </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>          P_data[<span class="fu">is.na</span>(P_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>          filtered_P <span class="ot">&lt;-</span> P_data[P_data <span class="sc">!=</span> <span class="dv">0</span>]         Ç</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Remove years with no price data.</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>          Last_Pyr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">colnames</span>(filtered_P))) </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Identify the last year with price data != 0.</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>          yr.name <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">colnames</span>(La_hist)[yr]) </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Actual year.</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>          nyr <span class="ot">&lt;-</span> <span class="fu">length</span>(yr.name<span class="sc">:</span>Last_Pyr)<span class="sc">-</span><span class="dv">1</span>      </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Number of years since the last price data.</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        Pa <span class="ot">&lt;-</span> Pa<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>addRP)<span class="sc">^</span>nyr</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      fms<span class="sc">@</span>price[a,yr,,ss] <span class="ot">&lt;-</span> Pa      </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [na,it]</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="er">}</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]] <span class="ot">&lt;-</span> fms</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fleets)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="price-model-selection" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="price-model-selection"><span class="header-section-number">3</span> PRICE MODEL SELECTION</h2>
<p>In this section we explain how determine the price dynamics to be implement for the simulations for each species and fleet or metier. Firstly, data must be collected in the correct format. Then, run price models from deliverable 2.2. Next, assess the suitability of each model thought the Root Mean Square Error (RMSE) by hindcasting on only 2/3 of the data and forecasting 1/3 of the data. This approach allows us to select the best-fitted model for each stock, fleet segment or mètier and age (if the price functions is done by age group, which is optional).<br>
The price data can be find in data from STECF or first sale notes. Landing data from ICES Working Groups (for example, Ices Working Group on Mixed Fisheries), STECF data or loogbooks. The correspondences of fleets segments of landings data and price data had to be aligned, although it`s not always straightforward and assumptions may need to be made.<br>
The following script is an example. This code was used to select the best price function for the HAKE, that is caught by French and Spanish fleets.</p>
<p>More information and example in this <a href="https://coispa.github.io/Fish-price-and-variable-costs/">link</a> you can find a detailed example.</p>
<p>READ AND PREPARE DATA</p>
<div class="cell" data-fold="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="st">'C:/xxx'</span> <span class="co"># Working directory</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(wd) <span class="co"># Set working directory</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the Catch table of FDI datacall, but the script can be adapted to read any dataset with landings and revenues.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stecf.jrc.ec.europa.eu/dd/fdi</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>FDI_France <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd, <span class="st">'/Data/Demersals/FDI_France.csv'</span>), <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Select data for Frech fleets catching HKE.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FDI_France) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Country"</span>, <span class="st">"Year"</span>, <span class="st">"Quarter"</span>, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Vessel.Length.Category"</span>, <span class="st">"Fishing.Technique"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Gear.Type"</span>, <span class="st">"Target.assemblage"</span>, <span class="st">"Mesh.size.range"</span>, </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Metier"</span>, <span class="st">"Supra.region"</span>, <span class="st">"Sub.region"</span>, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"EEZ.Indicator"</span>,<span class="st">"Geo.Indicator"</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Geo.Nephrops.sub.region"</span>, <span class="st">"Deep"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Species"</span>, <span class="st">"tot_live_weight_landed..tonnes."</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"tot_value_landings..euros."</span>,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Total.Discards..tonnes."</span>) </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Select data for Spanish fleets catching HKE.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>FDI_Spain    <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd, <span class="st">'/Data/Demersals/FDI_Spain.csv'</span>), <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FDI_Spain) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Country"</span>, <span class="st">"Year"</span>, <span class="st">"Quarter"</span>, <span class="st">"Vessel.Length.Category"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Fishing.Technique"</span>, <span class="st">"Gear.Type"</span>, <span class="st">"Target.assemblage"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Mesh.size.range"</span>, <span class="st">"Metier"</span>, <span class="st">"Supra.region"</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Sub.region"</span>, <span class="st">"EEZ.Indicator"</span>, <span class="st">"Geo.Indicator"</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Geo.Nephrops.sub.region"</span>, <span class="st">"Deep"</span>, <span class="st">"Species"</span>, </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"tot_live_weight_landed..tonnes."</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"tot_value_landings..euros."</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Total.Discards..tonnes."</span>)  </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(FDI_France, FDI_Spain) <span class="co"># Merge both data bases.</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Selection of species and area</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HKE"</span>) <span class="co"># Select target species.</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>ww      <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"27.8.A"</span>,  <span class="st">"27.8.B"</span>, <span class="st">"27.8.D"</span>) <span class="co"># Select the case study area.</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>Gear <span class="ot">&lt;-</span> <span class="fu">substr</span>(land_data<span class="sc">$</span>Metier, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the fishing gear</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>DemGear        <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"GNS"</span>, <span class="st">"GTR"</span>, <span class="st">"LLS"</span>, <span class="st">"OTB"</span>, <span class="st">"PTB"</span>, <span class="st">"OTM"</span>, <span class="st">"SSC"</span>) </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>land_data      <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>Species <span class="sc">%in%</span> species <span class="sc">&amp;</span> </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>                              land_data<span class="sc">$</span>Sub.region <span class="sc">%in%</span> ww <span class="sc">&amp;</span> </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>                              land_data<span class="sc">$</span>Gear <span class="sc">%in%</span> DemGear,]</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>tot_live_weight_landed..tonnes. <span class="sc">!=</span> <span class="st">"C"</span>, ]</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>tot_value_landings..euros. <span class="sc">!=</span> <span class="st">"C"</span>, ]</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>tot_live_weight_landed..tonnes. <span class="sc">!=</span> <span class="st">"NA"</span>, ]</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>tot_live_weight_landed..tonnes. <span class="ot">&lt;-</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(land_data<span class="sc">$</span>tot_live_weight_landed..tonnes.)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>tot_value_landings..euros.  <span class="ot">&lt;-</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(land_data<span class="sc">$</span>tot_value_landings..euros.)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>FS <span class="ot">&lt;-</span> <span class="fu">paste</span>(land_data<span class="sc">$</span>Country, <span class="fu">substr</span>(land_data<span class="sc">$</span>Metier, <span class="dv">1</span>, <span class="dv">3</span>), </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                      land_data<span class="sc">$</span>Vessel.Length.Category, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>land_data2 <span class="ot">&lt;-</span> land_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(FS, Year) <span class="sc">%&gt;%</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Landings =</span> <span class="fu">sum</span>(tot_live_weight_landed..tonnes.),</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>   <span class="at">Revenues =</span> <span class="fu">sum</span>(tot_value_landings..euros.)) <span class="co"># Compute landings and revenues.</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values in value and 0 values in weight</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>land_data2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(land_data2, <span class="sc">!</span><span class="fu">is.na</span>(land_data2<span class="sc">$</span>Revenues))</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>land_data2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(land_data2, Landings <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Price average</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>land_data2<span class="sc">$</span>price <span class="ot">&lt;-</span> land_data2<span class="sc">$</span>Revenues<span class="sc">/</span>(land_data2<span class="sc">$</span>Landings<span class="sc">*</span><span class="dv">1000</span>) </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>land_data2       <span class="ot">&lt;-</span> <span class="fu">subset</span>(land_data2, <span class="sc">!</span><span class="fu">is.na</span>(price)) <span class="co"># Clean data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>CHOOSE THE BEST PRICE DYNAMICS MODEL</p>
<div class="cell" data-fold="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create folder to save model fittings</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create("FishPrice")</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>wd.out <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Fish_Price_Dem/"</span>, species, <span class="st">"Best_model"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create(wd.out) # run first time</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Calculate elasticity coefficients </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Hindcasting only on 2/3 of the data -&gt; for RMSE but the final model all the data</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>strata <span class="ot">&lt;-</span> <span class="fu">unique</span>(land_data2<span class="sc">$</span>FS)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 #</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (i in c(1:16)){</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                                   land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">/</span>                                                                                                    land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hindcasting only on 2/3 of the data </span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">&gt;</span><span class="dv">5</span>) {</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">lm</span>((ratio<span class="dv">-1</span>)<span class="sc">~</span>ratio2<span class="sc">+</span><span class="dv">0</span>, <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model1.csv"</span>),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 #</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="co"># This model is not included because depends on imports, exogenous variable.</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 #</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                                   land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, </span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">data =</span> land_data2_temp[hind_indices,]), <span class="at">silent =</span> <span class="cn">TRUE</span>), <span class="dv">5</span>)</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model3.csv"</span>),</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4 #</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  land_data2_temp           <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price[<span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton       <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]<span class="er">)</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Ton), </span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Landings), </span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model4.csv"</span>),</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5 #</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>  land_data2_temp <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio[-1]=land_data2_temp$price[-1]/land_data2_temp$price[nrow(land_data2_temp)]</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$Ton &lt;- land_data2_temp$Landings</span></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])</span></span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>epsilon     <span class="ot">&lt;-</span> <span class="fu">mean</span>(land_data2_temp<span class="sc">$</span>price[hind_indices])  </span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model5.csv"</span>),</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6 #</span></span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a><span class="co"># In FLBEIA the price is estimated by age. To be checked with AZTI</span></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="dv">1</span>]</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton        <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Ton[<span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Ton[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model6.csv"</span>),</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Binding the model results</span></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> wd.out,</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pattern =</span> <span class="st">"(model)"</span>,</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>                      <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> <span class="fu">read.table</span>(results[<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T) </span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(results)) {</span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>  data2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(results[r], <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T) </span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>  data_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_, data2) </span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>PLOT PRICE MODEL</p>
<div class="cell" data-fold="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data_ &lt;- read.table(file.path(wd.out.sp, "Coefficientes.csv"),</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                     sep = ";")</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>data_<span class="sc">$</span>RMSE   <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>data_<span class="sc">$</span>points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe to save model fittings</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>land_data2_tempp            <span class="ot">&lt;-</span> land_data2[<span class="dv">1</span>,]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#land_data2_tempp$price_Mod2=0</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod3 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod4 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod5 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod6 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># r=1</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata)) {</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Observed</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  land_data2_temp <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]  </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(land_data2_temp)<span class="sc">&gt;</span><span class="dv">2</span>) {</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>points <span class="ot">&lt;-</span> <span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">jpeg</span>(<span class="fu">paste</span>(wd.out, <span class="st">"/graph"</span>, r, <span class="st">".jpg"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">"cm"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">20</span>, <span class="at">res =</span> <span class="dv">400</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price, </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab=</span><span class="st">"Price/kg (euro)"</span>, <span class="at">xlab =</span> <span class="st">"Year"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> strata[r],</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span><span class="sc">*</span><span class="fu">max</span>(land_data2_temp<span class="sc">$</span>price)),</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">"dark grey"</span>,</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.3</span>)  </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 1 #</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod1     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># land_data2_temp$price_Mod1[-1] &lt;- round(land_data2_temp$price[-nrow(land_data2_temp)]*(1+data_temp$epsilon*(land_data2_temp$Landings[-1]-land_data2_temp$Landings[-nrow(land_data2_temp)])/land_data2_temp$Landings[-1]), 5)</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: equation for model 1</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod1[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>data_temp<span class="sc">$</span>epsilon<span class="sc">*</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]), <span class="dv">5</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod1[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod1,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"green"</span>,</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod1[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 2 #</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 3 #</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod3     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod3[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]<span class="sc">*</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">^</span>data_temp<span class="sc">$</span>epsilon, <span class="dv">5</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod3[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod3,</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==3</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod3[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 4 #</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">4</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod4     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod4[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="fu">nrow</span>(land_data2_temp)]<span class="sc">*</span><span class="fu">exp</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">*</span>data_temp<span class="sc">$</span>epsilon), <span class="dv">5</span>)</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod4[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod4, </span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"orange"</span>,</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==4</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">4</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">4</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod4[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 5 #</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">5</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod5 <span class="ot">&lt;-</span> data_temp<span class="sc">$</span>epsilon</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">#land_data2_temp$price_Mod3[-1]=land_data2_temp$price[-nrow(land_data2_temp)]*(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])^data_temp$epsilon</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>    <span class="co">#land_data2_temp$price_Mod3[1]=NA</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod5,</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>          <span class="at">lty =</span> <span class="st">"dotted"</span>)  </span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==5</span></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">5</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">5</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod5[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 6 #</span></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">6</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod6     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod6[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="dv">1</span>]<span class="sc">*</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>])<span class="sc">^</span>data_temp<span class="sc">$</span>epsilon, <span class="dv">5</span>)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod6[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod6,</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"turquoise"</span>,</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==6</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">6</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">6</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod6[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Model1"</span>, <span class="st">"Model3"</span>, <span class="st">"Model4"</span>, <span class="st">"Model5"</span>, <span class="st">"Model6"</span>),</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"dark grey"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"black"</span>, <span class="st">"turquoise"</span>),</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>           <span class="at">lty =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span>, <span class="st">"solid"</span>),</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    land_data2_tempp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(land_data2_tempp, land_data2_temp)</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dev.off()</span></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">graphics.off</span>()</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># end if statement</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(land_data2_tempp[<span class="sc">-</span><span class="dv">1</span>,], <span class="fu">file.path</span>(wd.out, <span class="st">"Price_fittings.csv"</span>),</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>RMSE<span class="sc">!=</span><span class="dv">0</span>,]</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(data_, <span class="fu">file.path</span>(wd.out, <span class="st">"Fit_RMSE.csv"</span>),</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>            <span class="at">dec =</span> <span class="st">"."</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>data_best_fit <span class="ot">&lt;-</span> data_ <span class="sc">%&gt;%</span> </span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FS) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.min</span>(RMSE))</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(data_best_fit, <span class="fu">file.path</span>(wd.out, <span class="st">"Best_fit_RMSE.csv"</span>),</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>            <span class="at">dec =</span> <span class="st">"."</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>FIT THE MODEL FOR EACH FLEET SEGMENT</p>
<div class="cell" data-fold="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create folder to save model fittings</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create("FishPrice")</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>wd.out <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Fish_Price/"</span>, species, <span class="st">"/Fit_model"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create(wd.out) # run first time</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate elasticity coefficients </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># hindcasting only on 2/3 of the data -&gt; for RMSE but the final model all the data</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>strata <span class="ot">&lt;-</span> <span class="fu">unique</span>(land_data2<span class="sc">$</span>FS)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 #</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (i in c(1:16)){</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data </span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">&gt;</span><span class="dv">5</span>) {</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">lm</span>((ratio<span class="dv">-1</span>)<span class="sc">~</span>ratio2<span class="sc">+</span><span class="dv">0</span>, <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model1.csv"</span>),</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 #</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 #</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,]), <span class="at">silent =</span> <span class="cn">TRUE</span>), <span class="dv">5</span>)</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model3.csv"</span>),</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4 #</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>  land_data2_temp           <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton       <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Ton), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Landings), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model4.csv"</span>),</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5 #</span></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>  land_data2_temp <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio[-1]=land_data2_temp$price[-1]/land_data2_temp$price[nrow(land_data2_temp)]</span></span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$Ton &lt;- land_data2_temp$Landings</span></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])</span></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>epsilon     <span class="ot">&lt;-</span> <span class="fu">mean</span>(land_data2_temp<span class="sc">$</span>price[hind_indices])  </span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model5.csv"</span>),</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6 #</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="co"># In FLBEIA the price is estimated by age. To be checked with AZTI</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="dv">1</span>]</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton        <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Ton[<span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Ton[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model6.csv"</span>),</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a><span class="co"># # Binding the model results</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a><span class="co"># results &lt;- list.files(path = wd.out,</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a><span class="co">#                       pattern = "(model)",</span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="co">#                       full.names = TRUE)</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a><span class="co"># data_ &lt;- read.table(results[1], sep = ";", header = T) </span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a><span class="co"># for (r in 2:length(results)) {</span></span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a><span class="co">#   data2 &lt;- read.table(results[r], sep = ";", header = T) </span></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="co">#   data_ &lt;- rbind(data_, data2) </span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="parameterization-for-simulations" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="parameterization-for-simulations"><span class="header-section-number">4</span> PARAMETERIZATION FOR SIMULATIONS</h2>
<p>Once the best price model is selected, then the parameterization need to be included in the model for simulations. For that, it is needed the excel file created from the previous code, that present the following columns:</p>
<ul>
<li>age: Age of the fish.<br>
</li>
<li>met: Metier.<br>
</li>
<li>FLBEIA type: The selected price dynamics model from the previous code.<br>
</li>
<li>els: The elasticity parameter.<br>
</li>
<li>P<sub>0</sub>: The base price.<br>
</li>
<li>P<sub>last</sub>: The last price of the time series.<br>
</li>
<li>L<sub>0</sub>: The reference landing.<br>
</li>
</ul>
<p>The following code sets up the price dynamics for selected stocks (HKE) in a FLBEIA simulation. It reads price parameters from aforementioned Excel file and assigns either a fixed price or the corresponding type of elastic price model to each fleet-metier-stock combination, depending on the specified type. You should place this code before running the FLBEIA simulation, during the model setup phase, typically in the script where you define control parameters (fleets.ctrl) and initialize fleet objects (fleets). This is usually done after loading biological and economic data, and before calling FLBEIA().</p>
<p>Important notes:<br>
- Ensure that the Excel file is correctly formatted and contains the necessary columns: flnm, mtnm, stnm, type, els, P0, Plast.<br>
- The units of price (that in this example are multiplied by 1000) should be in the correct scale.<br>
</p>
<div class="cell" data-fold="true">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>stocks_newPrice <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HKE"</span>, <span class="st">"ANK"</span>, <span class="st">"MEG"</span>, <span class="st">"MAC"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(stknp <span class="cf">in</span> stocks_newPrice){</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  price_fm <span class="ot">&lt;-</span><span class="fu">read.xlsx</span>(<span class="st">'./input/Price_param_stk_flt_met_clean.xlsx'</span>, <span class="at">sheet =</span> stknp)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  flq <span class="ot">&lt;-</span> biols[[stknp]]<span class="sc">@</span>n</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">units</span>(flq)<span class="ot">&lt;-</span> <span class="st">" "</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(comf <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(price_fm)){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    flnm <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"flnm"</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    mtnm <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"mtnm"</span>]</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    stnm <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"stnm"</span>]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"type"</span>]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (type <span class="sc">==</span> <span class="dv">5</span>){</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.min[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">"fixedPrice"</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.prev[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">"fixedPrice"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.fixedEff[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">"fixedPrice"</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      flq.elsa <span class="ot">&lt;-</span> flq</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      flq.elsa[] <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"els"</span>]<span class="sc">*</span><span class="dv">1000</span> <span class="co"># in fixedPrice els is the price</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>price <span class="ot">&lt;-</span> flq.elsa[]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.min[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">'elasticPrice'</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.prev[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">'elasticPrice'</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.fixedEff[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">'elasticPrice'</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    els <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"els"</span>]</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    P0 <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"P0"</span>]<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    Plast <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"Plast"</span>]<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    La <span class="ot">&lt;-</span> fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>landings.n <span class="sc">*</span> fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>landings.wt</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    La[<span class="fu">is.na</span>(La)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    row_sums_La <span class="ot">&lt;-</span> <span class="fu">quantSums</span>(La) <span class="co"># identify years with no landing data</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    filtered_La <span class="ot">&lt;-</span> La[,row_sums_La <span class="sc">!=</span> <span class="dv">0</span>,,,,] <span class="co"># Remove years with no landing data</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    La0 <span class="ot">&lt;-</span> filtered_La[, <span class="fu">min</span>(<span class="fu">dimnames</span>(filtered_La)<span class="sc">$</span>year)] <span class="co"># take the first landing year =! 0</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    flq.elsa <span class="ot">&lt;-</span> flq.La0 <span class="ot">&lt;-</span> flq.Pa0 <span class="ot">&lt;-</span> flq.Plast <span class="ot">&lt;-</span> flq</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    flq.elsa[] <span class="ot">&lt;-</span> els</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    flq.Pa0[]  <span class="ot">&lt;-</span> P0</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    flq.La0[]  <span class="ot">&lt;-</span> La0</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    flq.Plast[]  <span class="ot">&lt;-</span> Plast</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>price <span class="ot">&lt;-</span> flq.Plast</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.prev[[flnm]][[mtnm]][[stnm]][[<span class="st">'type'</span>]]   <span class="ot">&lt;-</span> type</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.elsa'</span>]] <span class="ot">&lt;-</span> flq.elsa</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.La0'</span>]] <span class="ot">&lt;-</span> flq.La0</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.Pa0'</span>]] <span class="ot">&lt;-</span> flq.Pa0</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'type'</span>]]   <span class="ot">&lt;-</span> type</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.total'</span>]] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="references" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="references"><span class="header-section-number">5</span> REFERENCES</h2>
<p><em>Salz, Pavel &amp; Buisman, Erik &amp; Frost, Hans &amp; Accadia, Paolo &amp; Prellezo, Raúl &amp; Soma, Katrine. (2011). FISHRENT; Bio-Economic simulation and optimisation model for fisheries</em>.</p>
<p><em>Kraak. 2004. An evaluation of MTAC – a program for the calculation of catch forecasts taking the mixed nature of the fisheries into account. Working Document at the ICES Working Group on Methods of Fish Stock Assessments, Lisbon, Portugal, 11-18 February 2004, ICES CM 2004/D:03.</em></p>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "SEAWISE_FLBEIA_PriceDynamics"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Marga Andrés"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Miren Altuna-Etxabe"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Affilation: AZTI"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "01/09/2025"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Contents"</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: "left"</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">    css: styles.css</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">    anchor-sections: true</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">    link-external-icon: true</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">    link-external-newwindow: true</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner: "#4097C2"</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner-image: logo.png</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner-color: white</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![](logo.png)</span><span class="ot">{fig-align="top" width="100"}</span><span class="co">](https://seawiseproject.org/)</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Link to SEAWISE web</span><span class="co">](https://seawiseproject.org/ "SEAWISE")</span> <span class="co">[</span><span class="ot">Link to SEAWISE Github</span><span class="co">](https://github.com/ices-tools-dev/SEAwise)</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## INTRODUCTION</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>This document describes the code used to integrate new price dynamics into FLBEIA simulations, based on the approach developed in the SEAWISE project. The process was carried out in several key steps:</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Price functions in FLBEIA**\</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    A comprehensive collection of candidate price functions was compiled for consideration, and how it is coded within FLBEIA.</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Price model selection**\</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    A systematic method was developed to evaluate and select the most appropriate price dynamics model.</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Parameterization for simulations**\</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>    Guidance is provided on how to include the parameterization of price dynamics in the model setup to enable realistic simulations.</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>The aim of this document is to explain how price dynamics can be integrated into simulations using FLBEIA. The code provided is not intended for execution, but rather to illustrate how price functions are parameterized and how they operate within the FLBEIA framework.</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## PRICE FUNCTIONS IN FLBEIA</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>The price of a species can be influenced by both exogenous factors (e.g., changes in imports) and endogenous factors (e.g., variations in landings or average size). In FLBEIA, only price functions dependent on endogenous variables are considered, as exogenous factors remain constant within the model framework.&nbsp; Before SEAWISE project, in FLBEIA were two price functions implemented:</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Fixed Price: The prices are given as input data and are unchanged within the simulation.\</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Elastic Price - Type 1: This function implements the price function used in <span class="sc">\[</span>Kraak et al., 2004<span class="sc">\]</span>(https://www.ices.dk/sites/pub/CM%20Doccuments/2004/D/WGMG04.pdf</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Elastic Price at age - Type 1: This function implements the price function used in <span class="co">[</span><span class="ot">Kraak et al., 2004</span><span class="co">](https://www.ices.dk/sites/pub/CM%20Doccuments/2004/D/WGMG04.pdf)</span> by considering the age.</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>In SEAWISE <span class="co">[</span><span class="ot">Deliverable 2.2.</span><span class="co">](https://data.dtu.dk/articles/online_resource/SEAwise_report_on_Carbon_footprint_economic_and_social_impacts_of_management_strategies/25012085?file=44083586)</span>, Section 3.1.1. presents several price functions to be included into <span class="co">[</span><span class="ot">FLBEIA</span><span class="co">](https://github.com/flr/FLBEIA)</span> to enhance the modeling of price dynamics. In addition, an external factor that, for example, causes the price to increase by a fixed percentage each year has also been included as an option. The selected prices model that were included in FLBEIA are:</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="fu">### Price model Type 1</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>This type was already coded already implemented before SEAWISE. The function was defined from *Salz et al. (2011)* and is defined as:</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>p_{s,f,t} = p_{s,f,0} \left( \frac{L_{s,f,t}}{L_{s,f,0}} \right)^{\varepsilon_{s,f}}</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>$$ where *s* is the species, *f* the fleet segment, *t* the time, *p* the price with the unit (€/kg), *L* the landing (in kg), *a* the age, *m* the metier and e *ε~s,f~* is elasticity coefficient price-landings.</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### Price model Type 2</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>Modified with respect to Salz et al. (2011)<span class="sc">\*</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>The price function is defined as:</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>p_{s,f,t} = p_{s,f,t-1} \left( \frac{L_{s,f,t}}{L_{s,f,t-1}} \right)^{\varepsilon_{s,f}}</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>In the original version of Salz et al. (2011), the ratio was calculated against a base year using instead of previous year.</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="fu">### Price model Type 3</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>Price as a function of relative changes in landings The price function is defined as:</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>p_{s,f,t} = p_{s,f,t-1} \left(1 + \varepsilon_{s,f} \cdot \frac{L_{s,f,t} - L_{s,f,t-1}}{L_{s,f,t-1}} \right)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="fu">### Price model Type 4</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a>Price as a function of the current landings and is defined as:</span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>p_{s,f,t} = p_{s,f,t=last}^ \cdot e^{\varepsilon_{s,f}L_{s,f,t}}</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>\</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$p_{\text{s,f,t=last}}$: is the price in the last year of simulation (€/kg)\</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\varepsilon_{s,f}$: is the elasticity coefficient for price–landings</span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a>The FLBEIA team has enhanced the code to incorporate additional price dynamics, which can be applied at either the fleet or métier level. The price dynamics can also be defined considering the age of the fish, or without consider the age, i.e., the same function for all ages. The updated code is available <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/flr/FLBEIA/blob/master/R/OM_2c_Price_Dynamics.R#L1:)</span>, code that we briefly describe below:</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>Available Functions are divided in:&nbsp;</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**`fixedPrice`** where the price is provided as input and the function simply returns the object unchanged.\</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**`elasticPrice`** in which the elasticity function that models the price use the same formula for all age groups.\</span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**`elasticPriceAge`**: Elasticity function that models the price using different formulas for each age group.\</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a>The options for <span class="in">`elasticPrice`</span> and <span class="in">`elasticPriceAge`</span> are:\</span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`total`</span>determines how the price function is conditioned: <span class="in">`TRUE`</span> is based on total landings and <span class="in">`FALSE`</span> based on landings of the specific fleet landings.\</span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`type`</span>specifies the elasticity function to use: <span class="in">`type1`</span> when price varies according to Kraak’s elasticity function (Kraak, 2004); <span class="in">`type2`</span> when price varies according to Function 3 from Deliverable 2.2.; <span class="in">`type3`</span> when the price varies according to Function 1 from Deliverable 2.2.; <span class="in">`type4`</span>when the price varies according to Function 4 from Deliverable 2.2. and <span class="in">`type5`</span> is equivalent to <span class="in">`fixedPrice`</span>.&nbsp;</span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`RP`</span>allows you to adjust the calculated price by increasing or decreasing it by a specific percentage.</span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>The following code is simply intended to explore how price functions are coded within FLBEIA and to understand their internal workings. It is not meant for model parameterization.</span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a>FIXED PRICE</span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, fold="TRUE"}</span></span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------------</span></span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>fixedPrice <span class="ot">&lt;-</span> <span class="cf">function</span>(fleets, covars, fleets.ctrl, <span class="at">year =</span> <span class="dv">1</span>, <span class="at">season =</span> <span class="dv">1</span>,...){</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fleets)</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a>ELASTIC PRICE</span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, fold="TRUE"}</span></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>elasticPrice <span class="ot">&lt;-</span> <span class="cf">function</span>(fleets, covars, fleets.ctrl, stnm, flnm, mtnm, </span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a>                         <span class="at">year =</span> <span class="dv">1</span>, <span class="at">season =</span> <span class="dv">1</span>){</span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>    fms      <span class="ot">&lt;-</span> fleets[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>    fms.ctrl <span class="ot">&lt;-</span> fleets.ctrl[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> year</span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> season</span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters </span></span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a>    elsa     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.elsa'</span>]][,ss,,,]  <span class="co"># [na,it] Price-landing elasticity.</span></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a>    La0      <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.La0'</span>]][,ss,,,]   <span class="co"># [na,it] Base landings.</span></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a>    Pa0      <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.Pa0'</span>]][,ss,,,]   <span class="co"># [na,it] Base price.</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a>    type     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">"type"</span>]]             <span class="co"># [n,it]  Numeric vector </span></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a>    total    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.total'</span>]]         <span class="co"># Logic:  If TRUE, the function</span></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># depends on total landings, and if FALSE on the landings </span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># of the fleet in question.</span></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fms.ctrl[[<span class="st">'pd.RP'</span>]])){RP   <span class="ot">&lt;-</span> <span class="cn">FALSE</span>  </span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># By default the price function does not have an added increase/decrease.</span></span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{  </span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a>      RP       <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.RP'</span>]]              </span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Logic: If TRUE, the function has an added increase/decrease, </span></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and if FALSE it does not.</span></span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a>      addRP    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.addRP'</span>]]                    </span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Percentage of the price increased/decreased. Same for all ages.</span></span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>      yr.addRP <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.yr'</span>]]          </span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Numeric vector. The year from which the price starts increasing</span></span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>      <span class="co"># or decreasing annually.</span></span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Landings</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(total <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr,,ss]</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr<span class="dv">-1</span>,,ss] </span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,,,ss] </span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr,,ss]</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr<span class="dv">-1</span>,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr<span class="dv">-1</span>,,ss]</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,,,ss]</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>    La_f     <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau)[drop<span class="ot">=</span>T]</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>    La_init  <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_init)[drop<span class="ot">=</span>T]</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>    La_hist  <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_hist)[drop<span class="ot">=</span>T]</span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Type</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">1</span>) { P <span class="ot">&lt;-</span> Pa0<span class="sc">*</span>(La0<span class="sc">/</span>La_f)<span class="sc">^</span>elsa }</span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> type <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> type <span class="sc">==</span> <span class="dv">4</span>) {  </span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>      els    <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(elsa)    <span class="co"># [n,it]</span></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>      L_f    <span class="ot">&lt;-</span> <span class="fu">sum</span>(La_f)           <span class="co"># [n,it]</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>      L_init <span class="ot">&lt;-</span> <span class="fu">sum</span>(La_init)        <span class="co"># [n,it]</span></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>      L_hist <span class="ot">&lt;-</span> <span class="fu">colSums</span>(La_hist)    <span class="co"># [n,it]</span></span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>      P_init <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, yr<span class="dv">-1</span>, , ss])  <span class="co"># [n,it]</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(L_f <span class="sc">==</span> <span class="dv">0</span>){P <span class="ot">&lt;-</span> <span class="cn">NA</span>          <span class="co"># When L_f = 0 -&gt; set P = NA</span></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(L_init<span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>          L_hist[<span class="fu">is.na</span>(L_hist)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>          filtered_L <span class="ot">&lt;-</span> L_hist[L_hist <span class="sc">!=</span> <span class="dv">0</span>]       </span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Remove years with no landing data.</span></span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>          Last_Lyr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">names</span>(filtered_L)))</span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Identify the last year with landing != 0.</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>          L_init <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(L_hist[<span class="fu">names</span>(L_hist)<span class="sc">==</span> Last_Lyr])  </span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Take the last landing != 0.</span></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>          P_init <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, <span class="fu">grepl</span>(Last_Lyr, <span class="fu">names</span>(L_hist)), , ss]) </span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Take the corresponding price data.</span></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>        } </span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">2</span>){P <span class="ot">&lt;-</span> P_init<span class="sc">*</span>(L_f<span class="sc">/</span>L_init)<span class="sc">^</span>els}</span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">3</span>){P <span class="ot">&lt;-</span> P_init<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>els<span class="sc">*</span>((L_f<span class="sc">-</span>L_init)<span class="sc">/</span>L_init))}</span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">4</span>){P <span class="ot">&lt;-</span> P_init<span class="sc">*</span><span class="fu">exp</span>(els<span class="sc">*</span>L_f)}</span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>    P <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(P <span class="sc">==</span> <span class="cn">Inf</span>, <span class="cn">NA</span>, P)    <span class="co"># When L_f = 0 -&gt; P = Inf -&gt; set P = NA</span></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Added increase/decrease in Price.</span></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(RP <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(type <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>        yr.addRP.pos <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(La_hist) <span class="sc">%in%</span> yr.addRP) </span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Identify the position of the year from which the price starts increasing or decreasing annually.</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>        nyr <span class="ot">&lt;-</span> yr<span class="sc">-</span>yr.addRP.pos<span class="sc">+</span><span class="dv">1</span>                </span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of years since the first year of the simulation.</span></span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>        P_data <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, <span class="dv">1</span><span class="sc">:</span>(yr<span class="dv">-1</span>), , ss]) </span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>        P_data[<span class="fu">is.na</span>(P_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>        filtered_P <span class="ot">&lt;-</span> P_data[P_data <span class="sc">!=</span> <span class="dv">0</span>]                 </span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Remove years with no price data.</span></span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>        Last_Pyr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">colnames</span>(filtered_P))) </span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Identify the last year with price data != 0.</span></span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>        yr.name <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">colnames</span>(La_hist)[yr])  </span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Actual year</span></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>        nyr <span class="ot">&lt;-</span> <span class="fu">length</span>(yr.name<span class="sc">:</span>Last_Pyr)<span class="sc">-</span><span class="dv">1</span>   </span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Number of years since the last price data.</span></span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>      P <span class="ot">&lt;-</span> P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>addRP)<span class="sc">^</span>nyr</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>    fms<span class="sc">@</span>price[, yr, , ss] <span class="ot">&lt;-</span> P </span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>    fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]] <span class="ot">&lt;-</span> fms</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fleets)</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a>ELASTIC PRICE BY AGE</span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, fold="TRUE"}</span></span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a>elasticPriceAge <span class="ot">&lt;-</span> <span class="cf">function</span>(fleets, covars, fleets.ctrl, stnm, flnm, mtnm, <span class="at">year =</span> <span class="dv">1</span>, <span class="at">season =</span> <span class="dv">1</span>){</span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>    fms      <span class="ot">&lt;-</span> fleets[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a>    fms.ctrl <span class="ot">&lt;-</span> fleets.ctrl[[flnm]][[mtnm]][[stnm]]</span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a>    yr <span class="ot">&lt;-</span> year</span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> season</span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>    elsa    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.elsa'</span>]][,ss,,,]<span class="co"># [na,it] Price-landing elasticity.</span></span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a>    La0     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.La0'</span>]][,ss,,,] <span class="co"># [na,it] Base landings.</span></span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>    Pa0     <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.Pa0'</span>]][,ss,,,] <span class="co"># [na,it] Base price.</span></span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a>    type    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">"type"</span>]]           </span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>    <span class="co"># [na,it] Numeric vector: The type depend on age.</span></span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a>    total   <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.total'</span>]] </span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Logic: If TRUE, the function depends on total landings, and if FALSE on the landings of the fleet in question.</span></span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(fms.ctrl[[<span class="st">'pd.RP'</span>]]))    {RP   <span class="ot">&lt;-</span> <span class="cn">FALSE</span>  </span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a>    <span class="co"># By default the price function does not have an added increase/decrease.</span></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{  </span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a>      RP       <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.RP'</span>]]      </span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Logic: If TRUE, the function has an added increase/decrease, </span></span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a>      <span class="co"># and if FALSE it does not.</span></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a>      addRP    <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.addRP'</span>]]</span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Percentage of the price increased/decreased. Same for all ages.</span></span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a>      yr.addRP <span class="ot">&lt;-</span> fms.ctrl[[<span class="st">'pd.yr'</span>]]  </span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [n,it] Numeric vector. The year from which the price starts increasing</span></span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>      <span class="co"># or decreasing annually.</span></span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Landings</span></span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(total <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr,,ss]</span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,yr<span class="dv">-1</span>,,ss] </span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> <span class="fu">landWStock</span>(fleets, stnm)[,,,ss] </span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a>      Lau      <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr,,ss]</span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a>      Lau_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,yr<span class="dv">-1</span>,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,yr<span class="dv">-1</span>,,ss]</span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a>      Lau_hist <span class="ot">&lt;-</span> fms<span class="sc">@</span>landings.wt[,,,ss] <span class="sc">*</span> fms<span class="sc">@</span>landings.n[,,,ss]</span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a>    La_f    <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau)[drop<span class="ot">=</span>T]</span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a>    La_init <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_init)[drop<span class="ot">=</span>T]</span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a>    La_hist <span class="ot">&lt;-</span> <span class="fu">unitSums</span>(Lau_hist)[drop<span class="ot">=</span>T]</span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a>    Pa_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>price[, yr<span class="dv">-1</span>, , ss]  <span class="co"># [na,it]</span></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Type</span></span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(a <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fms<span class="sc">@</span>range[[<span class="st">"min"</span>]]<span class="sc">:</span>fms<span class="sc">@</span>range[[<span class="st">"max"</span>]])){</span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a>      tpa <span class="ot">&lt;-</span> type[a]  <span class="co"># Price function of age a</span></span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">1</span>){Pa <span class="ot">&lt;-</span> Pa0[a]<span class="sc">*</span>(La0[a]<span class="sc">/</span>La_f[a])<span class="sc">^</span>elsa[a]</span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(La_f[a] <span class="sc">==</span> <span class="dv">0</span>){Pa <span class="ot">&lt;-</span> <span class="cn">NA</span>   <span class="co"># When L_f = 0 -&gt; set P = NA</span></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(La_init[a]<span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a>            La_hist[a,][<span class="fu">is.na</span>(La_hist[a,])] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a>            filtered_La <span class="ot">&lt;-</span> La_hist[a,][La_hist[a,] <span class="sc">!=</span> <span class="dv">0</span>]     </span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Remove years with no landing data.</span></span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a>            Last_Layr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">names</span>(filtered_La)))  </span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Identify the last year with landing != 0.</span></span>
<span id="cb10-304"><a href="#cb10-304" aria-hidden="true" tabindex="-1"></a>            La_init <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(La_hist[,<span class="fu">colnames</span>(La_hist)<span class="sc">==</span> Last_Layr])   </span>
<span id="cb10-305"><a href="#cb10-305" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Take the last landing =! 0.</span></span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a>            Pa_init <span class="ot">&lt;-</span> fms<span class="sc">@</span>price[, <span class="fu">grepl</span>(Last_Layr, <span class="fu">colnames</span>(La_hist)), , ss]</span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Take the corresponding price data.</span></span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">2</span>){Pa <span class="ot">&lt;-</span> Pa_init[a]<span class="sc">*</span>(La_f[a]<span class="sc">/</span>La_init[a])<span class="sc">^</span>elsa[a]} </span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">3</span>){Pa <span class="ot">&lt;-</span> Pa_init[a]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>elsa[a]<span class="sc">*</span>((La_f[a]<span class="sc">-</span>La_init[a])<span class="sc">/</span>La_init[a]))} </span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">4</span>){Pa <span class="ot">&lt;-</span> Pa_init[a]<span class="sc">*</span><span class="fu">exp</span>(elsa[a]<span class="sc">*</span>La_f[a])} </span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">5</span>){Pa <span class="ot">&lt;-</span> elsa[a]}</span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a>      Pa <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( Pa<span class="sc">==</span><span class="cn">Inf</span>, <span class="cn">NA</span>, Pa)  <span class="co"># When La_f = 0 -&gt; Pa = Inf -&gt; set Pa = NA</span></span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a><span class="at">INCREASE OR DECREASE THE PRICE OVER THE TIME SERIES OF THE SIMULATION</span></span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a><span class="st">```</span>{r, eval<span class="ot">=</span><span class="cn">FALSE</span>, fold<span class="ot">=</span><span class="st">"TRUE"</span>}</span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(RP <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(tpa <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> tpa <span class="sc">==</span> <span class="dv">5</span>){</span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a>          yr.addRP.pos <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(La_hist) <span class="sc">%in%</span> yr.addRP)</span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Identify the position of the year from which the price starts</span></span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a>          <span class="co"># increasing or decreasing annually.</span></span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a>          nyr <span class="ot">&lt;-</span> yr<span class="sc">-</span>yr.addRP.pos<span class="sc">+</span><span class="dv">1</span>    </span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Number of years since the first year of the simulation.</span></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a>          P_data <span class="ot">&lt;-</span> <span class="fu">quantMeans</span>(fms<span class="sc">@</span>price[, <span class="dv">1</span><span class="sc">:</span>(yr<span class="dv">-1</span>), , ss]) </span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a>          P_data[<span class="fu">is.na</span>(P_data)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a>          filtered_P <span class="ot">&lt;-</span> P_data[P_data <span class="sc">!=</span> <span class="dv">0</span>]         Ç</span>
<span id="cb10-333"><a href="#cb10-333" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Remove years with no price data.</span></span>
<span id="cb10-334"><a href="#cb10-334" aria-hidden="true" tabindex="-1"></a>          Last_Pyr <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(<span class="fu">colnames</span>(filtered_P))) </span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Identify the last year with price data != 0.</span></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a>          yr.name <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">colnames</span>(La_hist)[yr]) </span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Actual year.</span></span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a>          nyr <span class="ot">&lt;-</span> <span class="fu">length</span>(yr.name<span class="sc">:</span>Last_Pyr)<span class="sc">-</span><span class="dv">1</span>      </span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Number of years since the last price data.</span></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a>        Pa <span class="ot">&lt;-</span> Pa<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>addRP)<span class="sc">^</span>nyr</span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a>      fms<span class="sc">@</span>price[a,yr,,ss] <span class="ot">&lt;-</span> Pa      </span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a>      <span class="co"># [na,it]</span></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a>    fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]] <span class="ot">&lt;-</span> fms</span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fleets)</span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a><span class="fu">## PRICE MODEL SELECTION</span></span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a>In this section we explain how determine the price dynamics to be implement for the simulations for each species and fleet or metier. Firstly, data must be collected in the correct format. Then, run price models from deliverable 2.2. Next, assess the suitability of each model thought the Root Mean Square Error (RMSE) by hindcasting on only 2/3 of the data and forecasting 1/3 of the data. This approach allows us to select the best-fitted model for each stock, fleet segment or mètier and age (if the price functions is done by age group, which is optional).\</span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a>The price data can be find in data from STECF or first sale notes. Landing data from ICES Working Groups (for example, Ices Working Group on Mixed Fisheries), STECF data or loogbooks. The correspondences of fleets segments of landings data and price data had to be aligned, although it<span class="sc">\`</span>s not always straightforward and assumptions may need to be made.\</span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a>The following script is an example. This code was used to select the best price function for the HAKE, that is caught by French and Spanish fleets.</span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a>More information and example in this <span class="co">[</span><span class="ot">link</span><span class="co">](https://coispa.github.io/Fish-price-and-variable-costs/)</span> you can find a detailed example.</span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-362"><a href="#cb10-362" aria-hidden="true" tabindex="-1"></a>READ AND PREPARE DATA</span>
<span id="cb10-363"><a href="#cb10-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=TRUE, fold=TRUE}</span></span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="st">'C:/xxx'</span> <span class="co"># Working directory</span></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(wd) <span class="co"># Set working directory</span></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the Catch table of FDI datacall, but the script can be adapted to read any dataset with landings and revenues.</span></span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stecf.jrc.ec.europa.eu/dd/fdi</span></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a>FDI_France <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd, <span class="st">'/Data/Demersals/FDI_France.csv'</span>), <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Select data for Frech fleets catching HKE.</span></span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FDI_France) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Country"</span>, <span class="st">"Year"</span>, <span class="st">"Quarter"</span>, </span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Vessel.Length.Category"</span>, <span class="st">"Fishing.Technique"</span>,</span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Gear.Type"</span>, <span class="st">"Target.assemblage"</span>, <span class="st">"Mesh.size.range"</span>, </span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Metier"</span>, <span class="st">"Supra.region"</span>, <span class="st">"Sub.region"</span>, </span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"EEZ.Indicator"</span>,<span class="st">"Geo.Indicator"</span>,</span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Geo.Nephrops.sub.region"</span>, <span class="st">"Deep"</span>,</span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Species"</span>, <span class="st">"tot_live_weight_landed..tonnes."</span>,</span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"tot_value_landings..euros."</span>,</span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Total.Discards..tonnes."</span>) </span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a><span class="co"># Select data for Spanish fleets catching HKE.</span></span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a>FDI_Spain    <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(wd, <span class="st">'/Data/Demersals/FDI_Spain.csv'</span>), <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FDI_Spain) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Country"</span>, <span class="st">"Year"</span>, <span class="st">"Quarter"</span>, <span class="st">"Vessel.Length.Category"</span>,</span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Fishing.Technique"</span>, <span class="st">"Gear.Type"</span>, <span class="st">"Target.assemblage"</span>,</span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Mesh.size.range"</span>, <span class="st">"Metier"</span>, <span class="st">"Supra.region"</span>,</span>
<span id="cb10-391"><a href="#cb10-391" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Sub.region"</span>, <span class="st">"EEZ.Indicator"</span>, <span class="st">"Geo.Indicator"</span>,</span>
<span id="cb10-392"><a href="#cb10-392" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Geo.Nephrops.sub.region"</span>, <span class="st">"Deep"</span>, <span class="st">"Species"</span>, </span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"tot_live_weight_landed..tonnes."</span>,</span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"tot_value_landings..euros."</span>,</span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Total.Discards..tonnes."</span>)  </span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(FDI_France, FDI_Spain) <span class="co"># Merge both data bases.</span></span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Selection of species and area</span></span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a>species <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HKE"</span>) <span class="co"># Select target species.</span></span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a>ww      <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"27.8.A"</span>,  <span class="st">"27.8.B"</span>, <span class="st">"27.8.D"</span>) <span class="co"># Select the case study area.</span></span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>Gear <span class="ot">&lt;-</span> <span class="fu">substr</span>(land_data<span class="sc">$</span>Metier, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the fishing gear</span></span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a>DemGear        <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"GNS"</span>, <span class="st">"GTR"</span>, <span class="st">"LLS"</span>, <span class="st">"OTB"</span>, <span class="st">"PTB"</span>, <span class="st">"OTM"</span>, <span class="st">"SSC"</span>) </span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a>land_data      <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>Species <span class="sc">%in%</span> species <span class="sc">&amp;</span> </span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a>                              land_data<span class="sc">$</span>Sub.region <span class="sc">%in%</span> ww <span class="sc">&amp;</span> </span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a>                              land_data<span class="sc">$</span>Gear <span class="sc">%in%</span> DemGear,]</span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>tot_live_weight_landed..tonnes. <span class="sc">!=</span> <span class="st">"C"</span>, ]</span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>tot_value_landings..euros. <span class="sc">!=</span> <span class="st">"C"</span>, ]</span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a>land_data <span class="ot">&lt;-</span> land_data[land_data<span class="sc">$</span>tot_live_weight_landed..tonnes. <span class="sc">!=</span> <span class="st">"NA"</span>, ]</span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>tot_live_weight_landed..tonnes. <span class="ot">&lt;-</span></span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(land_data<span class="sc">$</span>tot_live_weight_landed..tonnes.)</span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>tot_value_landings..euros.  <span class="ot">&lt;-</span></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>(land_data<span class="sc">$</span>tot_value_landings..euros.)</span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a>land_data<span class="sc">$</span>FS <span class="ot">&lt;-</span> <span class="fu">paste</span>(land_data<span class="sc">$</span>Country, <span class="fu">substr</span>(land_data<span class="sc">$</span>Metier, <span class="dv">1</span>, <span class="dv">3</span>), </span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a>                      land_data<span class="sc">$</span>Vessel.Length.Category, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a>land_data2 <span class="ot">&lt;-</span> land_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(FS, Year) <span class="sc">%&gt;%</span></span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Landings =</span> <span class="fu">sum</span>(tot_live_weight_landed..tonnes.),</span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>   <span class="at">Revenues =</span> <span class="fu">sum</span>(tot_value_landings..euros.)) <span class="co"># Compute landings and revenues.</span></span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing NA values in value and 0 values in weight</span></span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>land_data2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(land_data2, <span class="sc">!</span><span class="fu">is.na</span>(land_data2<span class="sc">$</span>Revenues))</span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>land_data2 <span class="ot">&lt;-</span> <span class="fu">subset</span>(land_data2, Landings <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a><span class="co"># Price average</span></span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a>land_data2<span class="sc">$</span>price <span class="ot">&lt;-</span> land_data2<span class="sc">$</span>Revenues<span class="sc">/</span>(land_data2<span class="sc">$</span>Landings<span class="sc">*</span><span class="dv">1000</span>) </span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a>land_data2       <span class="ot">&lt;-</span> <span class="fu">subset</span>(land_data2, <span class="sc">!</span><span class="fu">is.na</span>(price)) <span class="co"># Clean data</span></span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a>CHOOSE THE BEST PRICE DYNAMICS MODEL</span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=TRUE, fold=TRUE}</span></span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a><span class="co"># create folder to save model fittings</span></span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create("FishPrice")</span></span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a>wd.out <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Fish_Price_Dem/"</span>, species, <span class="st">"Best_model"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create(wd.out) # run first time</span></span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. Calculate elasticity coefficients </span></span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a><span class="co"># Hindcasting only on 2/3 of the data -&gt; for RMSE but the final model all the data</span></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a>strata <span class="ot">&lt;-</span> <span class="fu">unique</span>(land_data2<span class="sc">$</span>FS)</span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 #</span></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (i in c(1:16)){</span></span>
<span id="cb10-456"><a href="#cb10-456" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a>                                   land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">/</span>                                                                                                    land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hindcasting only on 2/3 of the data </span></span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">&gt;</span><span class="dv">5</span>) {</span>
<span id="cb10-474"><a href="#cb10-474" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">lm</span>((ratio<span class="dv">-1</span>)<span class="sc">~</span>ratio2<span class="sc">+</span><span class="dv">0</span>, <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb10-475"><a href="#cb10-475" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model1.csv"</span>),</span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-481"><a href="#cb10-481" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 #</span></span>
<span id="cb10-482"><a href="#cb10-482" aria-hidden="true" tabindex="-1"></a><span class="co"># This model is not included because depends on imports, exogenous variable.</span></span>
<span id="cb10-483"><a href="#cb10-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-484"><a href="#cb10-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 #</span></span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb10-490"><a href="#cb10-490" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-491"><a href="#cb10-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-492"><a href="#cb10-492" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-493"><a href="#cb10-493" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-494"><a href="#cb10-494" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-495"><a href="#cb10-495" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-496"><a href="#cb10-496" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-497"><a href="#cb10-497" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb10-498"><a href="#cb10-498" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb10-499"><a href="#cb10-499" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb10-500"><a href="#cb10-500" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb10-501"><a href="#cb10-501" aria-hidden="true" tabindex="-1"></a>                                   land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])</span>
<span id="cb10-502"><a href="#cb10-502" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-503"><a href="#cb10-503" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb10-504"><a href="#cb10-504" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb10-505"><a href="#cb10-505" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb10-506"><a href="#cb10-506" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb10-507"><a href="#cb10-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-508"><a href="#cb10-508" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb10-509"><a href="#cb10-509" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-510"><a href="#cb10-510" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb10-511"><a href="#cb10-511" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb10-512"><a href="#cb10-512" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb10-513"><a href="#cb10-513" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, </span>
<span id="cb10-514"><a href="#cb10-514" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb10-515"><a href="#cb10-515" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">data =</span> land_data2_temp[hind_indices,]), <span class="at">silent =</span> <span class="cn">TRUE</span>), <span class="dv">5</span>)</span>
<span id="cb10-516"><a href="#cb10-516" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-517"><a href="#cb10-517" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb10-518"><a href="#cb10-518" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-519"><a href="#cb10-519" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-520"><a href="#cb10-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-521"><a href="#cb10-521" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model3.csv"</span>),</span>
<span id="cb10-522"><a href="#cb10-522" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-523"><a href="#cb10-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-524"><a href="#cb10-524" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4 #</span></span>
<span id="cb10-525"><a href="#cb10-525" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-526"><a href="#cb10-526" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-527"><a href="#cb10-527" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-528"><a href="#cb10-528" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb10-529"><a href="#cb10-529" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-530"><a href="#cb10-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a>  land_data2_temp           <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span></span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price[<span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton       <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb10-539"><a href="#cb10-539" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb10-540"><a href="#cb10-540" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/</span></span>
<span id="cb10-541"><a href="#cb10-541" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]<span class="er">)</span></span>
<span id="cb10-542"><a href="#cb10-542" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-543"><a href="#cb10-543" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb10-544"><a href="#cb10-544" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb10-545"><a href="#cb10-545" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb10-546"><a href="#cb10-546" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb10-547"><a href="#cb10-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-548"><a href="#cb10-548" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb10-549"><a href="#cb10-549" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-550"><a href="#cb10-550" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Ton), </span>
<span id="cb10-551"><a href="#cb10-551" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb10-552"><a href="#cb10-552" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb10-553"><a href="#cb10-553" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb10-554"><a href="#cb10-554" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Landings), </span>
<span id="cb10-555"><a href="#cb10-555" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), </span>
<span id="cb10-556"><a href="#cb10-556" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb10-557"><a href="#cb10-557" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-558"><a href="#cb10-558" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb10-559"><a href="#cb10-559" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-560"><a href="#cb10-560" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-561"><a href="#cb10-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-562"><a href="#cb10-562" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model4.csv"</span>),</span>
<span id="cb10-563"><a href="#cb10-563" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-564"><a href="#cb10-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-565"><a href="#cb10-565" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5 #</span></span>
<span id="cb10-566"><a href="#cb10-566" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-567"><a href="#cb10-567" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-568"><a href="#cb10-568" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-569"><a href="#cb10-569" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb10-570"><a href="#cb10-570" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-571"><a href="#cb10-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-572"><a href="#cb10-572" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-573"><a href="#cb10-573" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a>  land_data2_temp <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio[-1]=land_data2_temp$price[-1]/land_data2_temp$price[nrow(land_data2_temp)]</span></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$Ton &lt;- land_data2_temp$Landings</span></span>
<span id="cb10-578"><a href="#cb10-578" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb10-579"><a href="#cb10-579" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])</span></span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-581"><a href="#cb10-581" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb10-582"><a href="#cb10-582" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb10-585"><a href="#cb10-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-586"><a href="#cb10-586" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>epsilon     <span class="ot">&lt;-</span> <span class="fu">mean</span>(land_data2_temp<span class="sc">$</span>price[hind_indices])  </span>
<span id="cb10-588"><a href="#cb10-588" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-589"><a href="#cb10-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model5.csv"</span>),</span>
<span id="cb10-591"><a href="#cb10-591" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-592"><a href="#cb10-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-593"><a href="#cb10-593" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6 #</span></span>
<span id="cb10-594"><a href="#cb10-594" aria-hidden="true" tabindex="-1"></a><span class="co"># In FLBEIA the price is estimated by age. To be checked with AZTI</span></span>
<span id="cb10-595"><a href="#cb10-595" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-596"><a href="#cb10-596" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-597"><a href="#cb10-597" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-598"><a href="#cb10-598" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb10-599"><a href="#cb10-599" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-600"><a href="#cb10-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-601"><a href="#cb10-601" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-602"><a href="#cb10-602" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-603"><a href="#cb10-603" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-604"><a href="#cb10-604" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-605"><a href="#cb10-605" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-606"><a href="#cb10-606" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="dv">1</span>]</span>
<span id="cb10-607"><a href="#cb10-607" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton        <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb10-608"><a href="#cb10-608" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb10-609"><a href="#cb10-609" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Ton[<span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Ton[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb10-610"><a href="#cb10-610" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-611"><a href="#cb10-611" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hindcasting only on 2/3 of the data</span></span>
<span id="cb10-612"><a href="#cb10-612" aria-hidden="true" tabindex="-1"></a>  n            <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">*</span><span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">0</span>)</span>
<span id="cb10-613"><a href="#cb10-613" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp), n)</span>
<span id="cb10-614"><a href="#cb10-614" aria-hidden="true" tabindex="-1"></a>  fore         <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)) <span class="sc">%in%</span> hind_indices)</span>
<span id="cb10-615"><a href="#cb10-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-616"><a href="#cb10-616" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>fore_points <span class="ot">&lt;-</span> <span class="fu">paste</span>(fore, <span class="at">collapse =</span> <span class="st">","</span>)</span>
<span id="cb10-617"><a href="#cb10-617" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-618"><a href="#cb10-618" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb10-619"><a href="#cb10-619" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb10-620"><a href="#cb10-620" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb10-621"><a href="#cb10-621" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-622"><a href="#cb10-622" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb10-623"><a href="#cb10-623" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-624"><a href="#cb10-624" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-625"><a href="#cb10-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-626"><a href="#cb10-626" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model6.csv"</span>),</span>
<span id="cb10-627"><a href="#cb10-627" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-628"><a href="#cb10-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-629"><a href="#cb10-629" aria-hidden="true" tabindex="-1"></a><span class="co"># Binding the model results</span></span>
<span id="cb10-630"><a href="#cb10-630" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> wd.out,</span>
<span id="cb10-631"><a href="#cb10-631" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pattern =</span> <span class="st">"(model)"</span>,</span>
<span id="cb10-632"><a href="#cb10-632" aria-hidden="true" tabindex="-1"></a>                      <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-633"><a href="#cb10-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-634"><a href="#cb10-634" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> <span class="fu">read.table</span>(results[<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T) </span>
<span id="cb10-635"><a href="#cb10-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-636"><a href="#cb10-636" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(results)) {</span>
<span id="cb10-637"><a href="#cb10-637" aria-hidden="true" tabindex="-1"></a>  data2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(results[r], <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">header =</span> T) </span>
<span id="cb10-638"><a href="#cb10-638" aria-hidden="true" tabindex="-1"></a>  data_ <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_, data2) </span>
<span id="cb10-639"><a href="#cb10-639" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-640"><a href="#cb10-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-641"><a href="#cb10-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-642"><a href="#cb10-642" aria-hidden="true" tabindex="-1"></a>PLOT PRICE MODEL</span>
<span id="cb10-643"><a href="#cb10-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-644"><a href="#cb10-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=TRUE, fold=TRUE}</span></span>
<span id="cb10-645"><a href="#cb10-645" aria-hidden="true" tabindex="-1"></a><span class="co"># data_ &lt;- read.table(file.path(wd.out.sp, "Coefficientes.csv"),</span></span>
<span id="cb10-646"><a href="#cb10-646" aria-hidden="true" tabindex="-1"></a><span class="co">#                     sep = ";")</span></span>
<span id="cb10-647"><a href="#cb10-647" aria-hidden="true" tabindex="-1"></a>data_<span class="sc">$</span>RMSE   <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-648"><a href="#cb10-648" aria-hidden="true" tabindex="-1"></a>data_<span class="sc">$</span>points <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-649"><a href="#cb10-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-650"><a href="#cb10-650" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframe to save model fittings</span></span>
<span id="cb10-651"><a href="#cb10-651" aria-hidden="true" tabindex="-1"></a>land_data2_tempp            <span class="ot">&lt;-</span> land_data2[<span class="dv">1</span>,]</span>
<span id="cb10-652"><a href="#cb10-652" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-653"><a href="#cb10-653" aria-hidden="true" tabindex="-1"></a><span class="co">#land_data2_tempp$price_Mod2=0</span></span>
<span id="cb10-654"><a href="#cb10-654" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod3 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-655"><a href="#cb10-655" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod4 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-656"><a href="#cb10-656" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod5 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-657"><a href="#cb10-657" aria-hidden="true" tabindex="-1"></a>land_data2_tempp<span class="sc">$</span>price_Mod6 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-658"><a href="#cb10-658" aria-hidden="true" tabindex="-1"></a><span class="co"># r=1</span></span>
<span id="cb10-659"><a href="#cb10-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-660"><a href="#cb10-660" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata)) {</span>
<span id="cb10-661"><a href="#cb10-661" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Observed</span></span>
<span id="cb10-662"><a href="#cb10-662" aria-hidden="true" tabindex="-1"></a>  land_data2_temp <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]  </span>
<span id="cb10-663"><a href="#cb10-663" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-664"><a href="#cb10-664" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(land_data2_temp)<span class="sc">&gt;</span><span class="dv">2</span>) {</span>
<span id="cb10-665"><a href="#cb10-665" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>points <span class="ot">&lt;-</span> <span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb10-666"><a href="#cb10-666" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-667"><a href="#cb10-667" aria-hidden="true" tabindex="-1"></a>    <span class="fu">jpeg</span>(<span class="fu">paste</span>(wd.out, <span class="st">"/graph"</span>, r, <span class="st">".jpg"</span>, <span class="at">sep =</span> <span class="st">""</span>),</span>
<span id="cb10-668"><a href="#cb10-668" aria-hidden="true" tabindex="-1"></a>         <span class="at">units =</span> <span class="st">"cm"</span>, <span class="at">width =</span> <span class="dv">35</span>, <span class="at">height =</span> <span class="dv">20</span>, <span class="at">res =</span> <span class="dv">400</span>)</span>
<span id="cb10-669"><a href="#cb10-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-670"><a href="#cb10-670" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price, </span>
<span id="cb10-671"><a href="#cb10-671" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylab=</span><span class="st">"Price/kg (euro)"</span>, <span class="at">xlab =</span> <span class="st">"Year"</span>,</span>
<span id="cb10-672"><a href="#cb10-672" aria-hidden="true" tabindex="-1"></a>         <span class="at">main =</span> strata[r],</span>
<span id="cb10-673"><a href="#cb10-673" aria-hidden="true" tabindex="-1"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span><span class="sc">*</span><span class="fu">max</span>(land_data2_temp<span class="sc">$</span>price)),</span>
<span id="cb10-674"><a href="#cb10-674" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="st">"dark grey"</span>,</span>
<span id="cb10-675"><a href="#cb10-675" aria-hidden="true" tabindex="-1"></a>         <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb10-676"><a href="#cb10-676" aria-hidden="true" tabindex="-1"></a>         <span class="at">cex =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.3</span>)  </span>
<span id="cb10-677"><a href="#cb10-677" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-678"><a href="#cb10-678" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 1 #</span></span>
<span id="cb10-679"><a href="#cb10-679" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb10-680"><a href="#cb10-680" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-681"><a href="#cb10-681" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod1     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-682"><a href="#cb10-682" aria-hidden="true" tabindex="-1"></a>    <span class="co"># land_data2_temp$price_Mod1[-1] &lt;- round(land_data2_temp$price[-nrow(land_data2_temp)]*(1+data_temp$epsilon*(land_data2_temp$Landings[-1]-land_data2_temp$Landings[-nrow(land_data2_temp)])/land_data2_temp$Landings[-1]), 5)</span></span>
<span id="cb10-683"><a href="#cb10-683" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: equation for model 1</span></span>
<span id="cb10-684"><a href="#cb10-684" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod1[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>data_temp<span class="sc">$</span>epsilon<span class="sc">*</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]), <span class="dv">5</span>)</span>
<span id="cb10-685"><a href="#cb10-685" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod1[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-686"><a href="#cb10-686" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-687"><a href="#cb10-687" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod1,</span>
<span id="cb10-688"><a href="#cb10-688" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"green"</span>,</span>
<span id="cb10-689"><a href="#cb10-689" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb10-690"><a href="#cb10-690" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-691"><a href="#cb10-691" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb10-692"><a href="#cb10-692" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb10-693"><a href="#cb10-693" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod1[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb10-694"><a href="#cb10-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-695"><a href="#cb10-695" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 2 #</span></span>
<span id="cb10-696"><a href="#cb10-696" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-697"><a href="#cb10-697" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 3 #</span></span>
<span id="cb10-698"><a href="#cb10-698" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb10-699"><a href="#cb10-699" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-700"><a href="#cb10-700" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod3     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-701"><a href="#cb10-701" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod3[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]<span class="sc">*</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">^</span>data_temp<span class="sc">$</span>epsilon, <span class="dv">5</span>)</span>
<span id="cb10-702"><a href="#cb10-702" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod3[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-703"><a href="#cb10-703" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-704"><a href="#cb10-704" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod3,</span>
<span id="cb10-705"><a href="#cb10-705" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"blue"</span>,</span>
<span id="cb10-706"><a href="#cb10-706" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb10-707"><a href="#cb10-707" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-708"><a href="#cb10-708" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb10-709"><a href="#cb10-709" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb10-710"><a href="#cb10-710" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==3</span></span>
<span id="cb10-711"><a href="#cb10-711" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb10-712"><a href="#cb10-712" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">3</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod3[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb10-713"><a href="#cb10-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-714"><a href="#cb10-714" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 4 #</span></span>
<span id="cb10-715"><a href="#cb10-715" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">4</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb10-716"><a href="#cb10-716" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-717"><a href="#cb10-717" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod4     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-718"><a href="#cb10-718" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod4[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="fu">nrow</span>(land_data2_temp)]<span class="sc">*</span><span class="fu">exp</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">*</span>data_temp<span class="sc">$</span>epsilon), <span class="dv">5</span>)</span>
<span id="cb10-719"><a href="#cb10-719" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod4[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-720"><a href="#cb10-720" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-721"><a href="#cb10-721" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod4, </span>
<span id="cb10-722"><a href="#cb10-722" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"orange"</span>,</span>
<span id="cb10-723"><a href="#cb10-723" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb10-724"><a href="#cb10-724" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-725"><a href="#cb10-725" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb10-726"><a href="#cb10-726" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb10-727"><a href="#cb10-727" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==4</span></span>
<span id="cb10-728"><a href="#cb10-728" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">4</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb10-729"><a href="#cb10-729" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">4</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod4[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb10-730"><a href="#cb10-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-731"><a href="#cb10-731" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 5 #</span></span>
<span id="cb10-732"><a href="#cb10-732" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">5</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]</span>
<span id="cb10-733"><a href="#cb10-733" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-734"><a href="#cb10-734" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod5 <span class="ot">&lt;-</span> data_temp<span class="sc">$</span>epsilon</span>
<span id="cb10-735"><a href="#cb10-735" aria-hidden="true" tabindex="-1"></a>    <span class="co">#land_data2_temp$price_Mod3[-1]=land_data2_temp$price[-nrow(land_data2_temp)]*(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])^data_temp$epsilon</span></span>
<span id="cb10-736"><a href="#cb10-736" aria-hidden="true" tabindex="-1"></a>    <span class="co">#land_data2_temp$price_Mod3[1]=NA</span></span>
<span id="cb10-737"><a href="#cb10-737" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-738"><a href="#cb10-738" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod5,</span>
<span id="cb10-739"><a href="#cb10-739" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"black"</span>,</span>
<span id="cb10-740"><a href="#cb10-740" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb10-741"><a href="#cb10-741" aria-hidden="true" tabindex="-1"></a>          <span class="at">lty =</span> <span class="st">"dotted"</span>)  </span>
<span id="cb10-742"><a href="#cb10-742" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-743"><a href="#cb10-743" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb10-744"><a href="#cb10-744" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb10-745"><a href="#cb10-745" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==5</span></span>
<span id="cb10-746"><a href="#cb10-746" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">5</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb10-747"><a href="#cb10-747" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">5</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod5[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb10-748"><a href="#cb10-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-749"><a href="#cb10-749" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Model 6 #</span></span>
<span id="cb10-750"><a href="#cb10-750" aria-hidden="true" tabindex="-1"></a>    data_temp <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">6</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],] </span>
<span id="cb10-751"><a href="#cb10-751" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-752"><a href="#cb10-752" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod6     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-753"><a href="#cb10-753" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod6[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(land_data2_temp<span class="sc">$</span>price[<span class="dv">1</span>]<span class="sc">*</span>(land_data2_temp<span class="sc">$</span>Landings[<span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>])<span class="sc">^</span>data_temp<span class="sc">$</span>epsilon, <span class="dv">5</span>)</span>
<span id="cb10-754"><a href="#cb10-754" aria-hidden="true" tabindex="-1"></a>    land_data2_temp<span class="sc">$</span>price_Mod6[<span class="dv">1</span>]  <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb10-755"><a href="#cb10-755" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-756"><a href="#cb10-756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lines</span>(land_data2_temp<span class="sc">$</span>Year, land_data2_temp<span class="sc">$</span>price_Mod6,</span>
<span id="cb10-757"><a href="#cb10-757" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">"turquoise"</span>,</span>
<span id="cb10-758"><a href="#cb10-758" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">4</span>)  </span>
<span id="cb10-759"><a href="#cb10-759" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-760"><a href="#cb10-760" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RMSE to be estimated on the forecast points</span></span>
<span id="cb10-761"><a href="#cb10-761" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fore                                            &lt;- as.numeric(str_split(data_[data_$MODEL==1 &amp; data_$FS==strata[r],]$fore_points, ",")[[1]])</span></span>
<span id="cb10-762"><a href="#cb10-762" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ane mod.: select fore_points from MODEL==6</span></span>
<span id="cb10-763"><a href="#cb10-763" aria-hidden="true" tabindex="-1"></a>    fore                                              <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">6</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>fore_points, <span class="st">","</span>)[[<span class="dv">1</span>]])</span>
<span id="cb10-764"><a href="#cb10-764" aria-hidden="true" tabindex="-1"></a>    data_[data_<span class="sc">$</span>MODEL<span class="sc">==</span><span class="dv">6</span> <span class="sc">&amp;</span> data_<span class="sc">$</span>FS<span class="sc">==</span>strata[r],]<span class="sc">$</span>RMSE <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>((land_data2_temp<span class="sc">$</span>price[fore]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>price_Mod6[fore])<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">/</span>(<span class="fu">length</span>(land_data2_temp<span class="sc">$</span>price[fore])<span class="sc">+</span><span class="dv">1</span>)), <span class="dv">5</span>) </span>
<span id="cb10-765"><a href="#cb10-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-766"><a href="#cb10-766" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">"topleft"</span>,</span>
<span id="cb10-767"><a href="#cb10-767" aria-hidden="true" tabindex="-1"></a>           <span class="fu">c</span>(<span class="st">"Observed"</span>, <span class="st">"Model1"</span>, <span class="st">"Model3"</span>, <span class="st">"Model4"</span>, <span class="st">"Model5"</span>, <span class="st">"Model6"</span>),</span>
<span id="cb10-768"><a href="#cb10-768" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"dark grey"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"orange"</span>, <span class="st">"black"</span>, <span class="st">"turquoise"</span>),</span>
<span id="cb10-769"><a href="#cb10-769" aria-hidden="true" tabindex="-1"></a>           <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb10-770"><a href="#cb10-770" aria-hidden="true" tabindex="-1"></a>           <span class="at">lty =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>, <span class="st">"solid"</span>, <span class="st">"dotted"</span>, <span class="st">"solid"</span>),</span>
<span id="cb10-771"><a href="#cb10-771" aria-hidden="true" tabindex="-1"></a>           <span class="at">lwd =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb10-772"><a href="#cb10-772" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-773"><a href="#cb10-773" aria-hidden="true" tabindex="-1"></a>    land_data2_tempp <span class="ot">&lt;-</span> <span class="fu">rbind</span>(land_data2_tempp, land_data2_temp)</span>
<span id="cb10-774"><a href="#cb10-774" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-775"><a href="#cb10-775" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dev.off()</span></span>
<span id="cb10-776"><a href="#cb10-776" aria-hidden="true" tabindex="-1"></a>    <span class="fu">graphics.off</span>()</span>
<span id="cb10-777"><a href="#cb10-777" aria-hidden="true" tabindex="-1"></a>  } <span class="co"># end if statement</span></span>
<span id="cb10-778"><a href="#cb10-778" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-779"><a href="#cb10-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-780"><a href="#cb10-780" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(land_data2_tempp[<span class="sc">-</span><span class="dv">1</span>,], <span class="fu">file.path</span>(wd.out, <span class="st">"Price_fittings.csv"</span>),</span>
<span id="cb10-781"><a href="#cb10-781" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-782"><a href="#cb10-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-783"><a href="#cb10-783" aria-hidden="true" tabindex="-1"></a>data_ <span class="ot">&lt;-</span> data_[data_<span class="sc">$</span>RMSE<span class="sc">!=</span><span class="dv">0</span>,]</span>
<span id="cb10-784"><a href="#cb10-784" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(data_, <span class="fu">file.path</span>(wd.out, <span class="st">"Fit_RMSE.csv"</span>),</span>
<span id="cb10-785"><a href="#cb10-785" aria-hidden="true" tabindex="-1"></a>            <span class="at">dec =</span> <span class="st">"."</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-786"><a href="#cb10-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-787"><a href="#cb10-787" aria-hidden="true" tabindex="-1"></a>data_best_fit <span class="ot">&lt;-</span> data_ <span class="sc">%&gt;%</span> </span>
<span id="cb10-788"><a href="#cb10-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FS) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">which.min</span>(RMSE))</span>
<span id="cb10-789"><a href="#cb10-789" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(data_best_fit, <span class="fu">file.path</span>(wd.out, <span class="st">"Best_fit_RMSE.csv"</span>),</span>
<span id="cb10-790"><a href="#cb10-790" aria-hidden="true" tabindex="-1"></a>            <span class="at">dec =</span> <span class="st">"."</span>, <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-791"><a href="#cb10-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-792"><a href="#cb10-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-793"><a href="#cb10-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-794"><a href="#cb10-794" aria-hidden="true" tabindex="-1"></a>FIT THE MODEL FOR EACH FLEET SEGMENT</span>
<span id="cb10-795"><a href="#cb10-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-796"><a href="#cb10-796" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=TRUE, fold=TRUE}</span></span>
<span id="cb10-797"><a href="#cb10-797" aria-hidden="true" tabindex="-1"></a><span class="co"># create folder to save model fittings</span></span>
<span id="cb10-798"><a href="#cb10-798" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create("FishPrice")</span></span>
<span id="cb10-799"><a href="#cb10-799" aria-hidden="true" tabindex="-1"></a>wd.out <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Fish_Price/"</span>, species, <span class="st">"/Fit_model"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb10-800"><a href="#cb10-800" aria-hidden="true" tabindex="-1"></a><span class="co"># dir.create(wd.out) # run first time</span></span>
<span id="cb10-801"><a href="#cb10-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-802"><a href="#cb10-802" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate elasticity coefficients </span></span>
<span id="cb10-803"><a href="#cb10-803" aria-hidden="true" tabindex="-1"></a><span class="co"># hindcasting only on 2/3 of the data -&gt; for RMSE but the final model all the data</span></span>
<span id="cb10-804"><a href="#cb10-804" aria-hidden="true" tabindex="-1"></a>strata <span class="ot">&lt;-</span> <span class="fu">unique</span>(land_data2<span class="sc">$</span>FS)</span>
<span id="cb10-805"><a href="#cb10-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-806"><a href="#cb10-806" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 1 #</span></span>
<span id="cb10-807"><a href="#cb10-807" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb10-808"><a href="#cb10-808" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-809"><a href="#cb10-809" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-810"><a href="#cb10-810" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-811"><a href="#cb10-811" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-812"><a href="#cb10-812" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb10-813"><a href="#cb10-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-814"><a href="#cb10-814" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-815"><a href="#cb10-815" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for (i in c(1:16)){</span></span>
<span id="cb10-816"><a href="#cb10-816" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-817"><a href="#cb10-817" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-818"><a href="#cb10-818" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-819"><a href="#cb10-819" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-820"><a href="#cb10-820" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb10-821"><a href="#cb10-821" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb10-822"><a href="#cb10-822" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb10-823"><a href="#cb10-823" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-824"><a href="#cb10-824" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data </span></span>
<span id="cb10-825"><a href="#cb10-825" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb10-826"><a href="#cb10-826" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb10-827"><a href="#cb10-827" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb10-828"><a href="#cb10-828" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb10-829"><a href="#cb10-829" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-830"><a href="#cb10-830" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb10-831"><a href="#cb10-831" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-832"><a href="#cb10-832" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(land_data2_temp)<span class="sc">&gt;</span><span class="dv">5</span>) {</span>
<span id="cb10-833"><a href="#cb10-833" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">lm</span>((ratio<span class="dv">-1</span>)<span class="sc">~</span>ratio2<span class="sc">+</span><span class="dv">0</span>, <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb10-834"><a href="#cb10-834" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-835"><a href="#cb10-835" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-836"><a href="#cb10-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-837"><a href="#cb10-837" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model1.csv"</span>),</span>
<span id="cb10-838"><a href="#cb10-838" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-839"><a href="#cb10-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-840"><a href="#cb10-840" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 2 #</span></span>
<span id="cb10-841"><a href="#cb10-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-842"><a href="#cb10-842" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 3 #</span></span>
<span id="cb10-843"><a href="#cb10-843" aria-hidden="true" tabindex="-1"></a><span class="co"># i=1</span></span>
<span id="cb10-844"><a href="#cb10-844" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-845"><a href="#cb10-845" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-846"><a href="#cb10-846" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-847"><a href="#cb10-847" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb10-848"><a href="#cb10-848" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb10-849"><a href="#cb10-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-850"><a href="#cb10-850" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-851"><a href="#cb10-851" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-852"><a href="#cb10-852" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-853"><a href="#cb10-853" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-854"><a href="#cb10-854" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-855"><a href="#cb10-855" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb10-856"><a href="#cb10-856" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb10-857"><a href="#cb10-857" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Landings[<span class="sc">-</span><span class="fu">nrow</span>(land_data2_temp)])</span>
<span id="cb10-858"><a href="#cb10-858" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-859"><a href="#cb10-859" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb10-860"><a href="#cb10-860" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb10-861"><a href="#cb10-861" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb10-862"><a href="#cb10-862" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb10-863"><a href="#cb10-863" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb10-864"><a href="#cb10-864" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-865"><a href="#cb10-865" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb10-866"><a href="#cb10-866" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-867"><a href="#cb10-867" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb10-868"><a href="#cb10-868" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb10-869"><a href="#cb10-869" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,]), <span class="at">silent =</span> <span class="cn">TRUE</span>), <span class="dv">5</span>)</span>
<span id="cb10-870"><a href="#cb10-870" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-871"><a href="#cb10-871" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb10-872"><a href="#cb10-872" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-873"><a href="#cb10-873" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-874"><a href="#cb10-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-875"><a href="#cb10-875" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model3.csv"</span>),</span>
<span id="cb10-876"><a href="#cb10-876" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-877"><a href="#cb10-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-878"><a href="#cb10-878" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 4 #</span></span>
<span id="cb10-879"><a href="#cb10-879" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-880"><a href="#cb10-880" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-881"><a href="#cb10-881" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-882"><a href="#cb10-882" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb10-883"><a href="#cb10-883" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb10-884"><a href="#cb10-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-885"><a href="#cb10-885" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-886"><a href="#cb10-886" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-887"><a href="#cb10-887" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-888"><a href="#cb10-888" aria-hidden="true" tabindex="-1"></a>  land_data2_temp           <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-889"><a href="#cb10-889" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-890"><a href="#cb10-890" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="fu">nrow</span>(land_data2_temp)]</span>
<span id="cb10-891"><a href="#cb10-891" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton       <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb10-892"><a href="#cb10-892" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb10-893"><a href="#cb10-893" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])</span></span>
<span id="cb10-894"><a href="#cb10-894" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-895"><a href="#cb10-895" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb10-896"><a href="#cb10-896" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb10-897"><a href="#cb10-897" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb10-898"><a href="#cb10-898" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb10-899"><a href="#cb10-899" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb10-900"><a href="#cb10-900" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-901"><a href="#cb10-901" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb10-902"><a href="#cb10-902" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-903"><a href="#cb10-903" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Ton), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb10-904"><a href="#cb10-904" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb10-905"><a href="#cb10-905" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span><span class="fu">exp</span>(a<span class="sc">*</span>Landings), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb10-906"><a href="#cb10-906" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-907"><a href="#cb10-907" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb10-908"><a href="#cb10-908" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-909"><a href="#cb10-909" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-910"><a href="#cb10-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-911"><a href="#cb10-911" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model4.csv"</span>),</span>
<span id="cb10-912"><a href="#cb10-912" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-913"><a href="#cb10-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-914"><a href="#cb10-914" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 5 #</span></span>
<span id="cb10-915"><a href="#cb10-915" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-916"><a href="#cb10-916" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-917"><a href="#cb10-917" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-918"><a href="#cb10-918" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb10-919"><a href="#cb10-919" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb10-920"><a href="#cb10-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-921"><a href="#cb10-921" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-922"><a href="#cb10-922" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-923"><a href="#cb10-923" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-924"><a href="#cb10-924" aria-hidden="true" tabindex="-1"></a>  land_data2_temp <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-925"><a href="#cb10-925" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio[-1]=land_data2_temp$price[-1]/land_data2_temp$price[nrow(land_data2_temp)]</span></span>
<span id="cb10-926"><a href="#cb10-926" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$Ton &lt;- land_data2_temp$Landings</span></span>
<span id="cb10-927"><a href="#cb10-927" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2=999</span></span>
<span id="cb10-928"><a href="#cb10-928" aria-hidden="true" tabindex="-1"></a>  <span class="co">#land_data2_temp$ratio2[-1]=(land_data2_temp$Ton[-1]/land_data2_temp$Ton[-nrow(land_data2_temp)])</span></span>
<span id="cb10-929"><a href="#cb10-929" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-930"><a href="#cb10-930" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb10-931"><a href="#cb10-931" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb10-932"><a href="#cb10-932" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb10-933"><a href="#cb10-933" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb10-934"><a href="#cb10-934" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb10-935"><a href="#cb10-935" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-936"><a href="#cb10-936" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb10-937"><a href="#cb10-937" aria-hidden="true" tabindex="-1"></a>  epsilon[i,]<span class="sc">$</span>epsilon     <span class="ot">&lt;-</span> <span class="fu">mean</span>(land_data2_temp<span class="sc">$</span>price[hind_indices])  </span>
<span id="cb10-938"><a href="#cb10-938" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-939"><a href="#cb10-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-940"><a href="#cb10-940" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model5.csv"</span>),</span>
<span id="cb10-941"><a href="#cb10-941" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-942"><a href="#cb10-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-943"><a href="#cb10-943" aria-hidden="true" tabindex="-1"></a><span class="co"># Model 6 #</span></span>
<span id="cb10-944"><a href="#cb10-944" aria-hidden="true" tabindex="-1"></a><span class="co"># In FLBEIA the price is estimated by age. To be checked with AZTI</span></span>
<span id="cb10-945"><a href="#cb10-945" aria-hidden="true" tabindex="-1"></a>epsilon             <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">epsilon =</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">1</span>, <span class="at">nrow=</span><span class="fu">length</span>(strata)))</span>
<span id="cb10-946"><a href="#cb10-946" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>FS          <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb10-947"><a href="#cb10-947" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>SPECIES     <span class="ot">&lt;-</span> species</span>
<span id="cb10-948"><a href="#cb10-948" aria-hidden="true" tabindex="-1"></a>epsilon<span class="sc">$</span>MODEL       <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb10-949"><a href="#cb10-949" aria-hidden="true" tabindex="-1"></a><span class="co"># epsilon$fore_points &lt;- 0</span></span>
<span id="cb10-950"><a href="#cb10-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-951"><a href="#cb10-951" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(strata))) {</span>
<span id="cb10-952"><a href="#cb10-952" aria-hidden="true" tabindex="-1"></a>  epsilon<span class="sc">$</span>FS[i] <span class="ot">&lt;-</span> strata[i]</span>
<span id="cb10-953"><a href="#cb10-953" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-954"><a href="#cb10-954" aria-hidden="true" tabindex="-1"></a>  land_data2_temp            <span class="ot">&lt;-</span> land_data2[land_data2<span class="sc">$</span>FS<span class="sc">==</span>strata[i],]</span>
<span id="cb10-955"><a href="#cb10-955" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio      <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-956"><a href="#cb10-956" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio[<span class="sc">-</span><span class="dv">1</span>]  <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>price[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>price[<span class="dv">1</span>]</span>
<span id="cb10-957"><a href="#cb10-957" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>Ton        <span class="ot">&lt;-</span> land_data2_temp<span class="sc">$</span>Landings</span>
<span id="cb10-958"><a href="#cb10-958" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2     <span class="ot">&lt;-</span> <span class="dv">999</span></span>
<span id="cb10-959"><a href="#cb10-959" aria-hidden="true" tabindex="-1"></a>  land_data2_temp<span class="sc">$</span>ratio2[<span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> (land_data2_temp<span class="sc">$</span>Ton[<span class="dv">1</span>]<span class="sc">/</span>land_data2_temp<span class="sc">$</span>Ton[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb10-960"><a href="#cb10-960" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-961"><a href="#cb10-961" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # hindcasting only on 2/3 of the data</span></span>
<span id="cb10-962"><a href="#cb10-962" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n            &lt;- round(nrow(land_data2_temp)*2/3, 0)</span></span>
<span id="cb10-963"><a href="#cb10-963" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hind_indices &lt;- sample(2:nrow(land_data2_temp), n)</span></span>
<span id="cb10-964"><a href="#cb10-964" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fore         &lt;- which(!seq(1:nrow(land_data2_temp)) %in% hind_indices)</span></span>
<span id="cb10-965"><a href="#cb10-965" aria-hidden="true" tabindex="-1"></a>  hind_indices <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(land_data2_temp)</span>
<span id="cb10-966"><a href="#cb10-966" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-967"><a href="#cb10-967" aria-hidden="true" tabindex="-1"></a>  <span class="co"># epsilon[i,]$fore_points &lt;- paste(fore, collapse = ",")</span></span>
<span id="cb10-968"><a href="#cb10-968" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-969"><a href="#cb10-969" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(<span class="fu">try</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])),</span>
<span id="cb10-970"><a href="#cb10-970" aria-hidden="true" tabindex="-1"></a>                <span class="at">silent =</span> <span class="cn">TRUE</span>)) <span class="sc">!=</span> <span class="st">"try-error"</span>) {</span>
<span id="cb10-971"><a href="#cb10-971" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coefficients</span>(<span class="fu">nls</span>((ratio)<span class="sc">~</span>(ratio2)<span class="sc">^</span>a, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a=</span><span class="dv">1</span>), <span class="at">data =</span> land_data2_temp[hind_indices,])), <span class="dv">5</span>)</span>
<span id="cb10-972"><a href="#cb10-972" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb10-973"><a href="#cb10-973" aria-hidden="true" tabindex="-1"></a>    epsilon[i,]<span class="sc">$</span>epsilon <span class="ot">&lt;-</span> <span class="cn">NA</span>  </span>
<span id="cb10-974"><a href="#cb10-974" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-975"><a href="#cb10-975" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-976"><a href="#cb10-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-977"><a href="#cb10-977" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(epsilon, <span class="fu">file.path</span>(wd.out, <span class="st">"Price_model6.csv"</span>),</span>
<span id="cb10-978"><a href="#cb10-978" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">row.names =</span> F)</span>
<span id="cb10-979"><a href="#cb10-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-980"><a href="#cb10-980" aria-hidden="true" tabindex="-1"></a><span class="co"># # Binding the model results</span></span>
<span id="cb10-981"><a href="#cb10-981" aria-hidden="true" tabindex="-1"></a><span class="co"># results &lt;- list.files(path = wd.out,</span></span>
<span id="cb10-982"><a href="#cb10-982" aria-hidden="true" tabindex="-1"></a><span class="co">#                       pattern = "(model)",</span></span>
<span id="cb10-983"><a href="#cb10-983" aria-hidden="true" tabindex="-1"></a><span class="co">#                       full.names = TRUE)</span></span>
<span id="cb10-984"><a href="#cb10-984" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-985"><a href="#cb10-985" aria-hidden="true" tabindex="-1"></a><span class="co"># data_ &lt;- read.table(results[1], sep = ";", header = T) </span></span>
<span id="cb10-986"><a href="#cb10-986" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-987"><a href="#cb10-987" aria-hidden="true" tabindex="-1"></a><span class="co"># for (r in 2:length(results)) {</span></span>
<span id="cb10-988"><a href="#cb10-988" aria-hidden="true" tabindex="-1"></a><span class="co">#   data2 &lt;- read.table(results[r], sep = ";", header = T) </span></span>
<span id="cb10-989"><a href="#cb10-989" aria-hidden="true" tabindex="-1"></a><span class="co">#   data_ &lt;- rbind(data_, data2) </span></span>
<span id="cb10-990"><a href="#cb10-990" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb10-991"><a href="#cb10-991" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-992"><a href="#cb10-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-993"><a href="#cb10-993" aria-hidden="true" tabindex="-1"></a><span class="fu">## PARAMETERIZATION FOR SIMULATIONS</span></span>
<span id="cb10-994"><a href="#cb10-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-995"><a href="#cb10-995" aria-hidden="true" tabindex="-1"></a>Once the best price model is selected, then the parameterization need to be included in the model for simulations. For that, it is needed the excel file created from the previous code, that present the following columns:</span>
<span id="cb10-996"><a href="#cb10-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-997"><a href="#cb10-997" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>age: Age of the fish.\</span>
<span id="cb10-998"><a href="#cb10-998" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>met: Metier.\</span>
<span id="cb10-999"><a href="#cb10-999" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>FLBEIA type: The selected price dynamics model from the previous code.\</span>
<span id="cb10-1000"><a href="#cb10-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>els: The elasticity parameter.\</span>
<span id="cb10-1001"><a href="#cb10-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>P~0~: The base price.\</span>
<span id="cb10-1002"><a href="#cb10-1002" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>P~last~: The last price of the time series.\</span>
<span id="cb10-1003"><a href="#cb10-1003" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>L~0~: The reference landing.\</span>
<span id="cb10-1004"><a href="#cb10-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1005"><a href="#cb10-1005" aria-hidden="true" tabindex="-1"></a>The following code sets up the price dynamics for selected stocks (HKE) in a FLBEIA simulation. It reads price parameters from aforementioned Excel file and assigns either a fixed price or the corresponding type of elastic price model to each fleet-metier-stock combination, depending on the specified type. You should place this code before running the FLBEIA simulation, during the model setup phase, typically in the script where you define control parameters (fleets.ctrl) and initialize fleet objects (fleets). This is usually done after loading biological and economic data, and before calling FLBEIA().</span>
<span id="cb10-1006"><a href="#cb10-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1007"><a href="#cb10-1007" aria-hidden="true" tabindex="-1"></a>Important notes:\</span>
<span id="cb10-1008"><a href="#cb10-1008" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Ensure that the Excel file is correctly formatted and contains the necessary columns: flnm, mtnm, stnm, type, els, P0, Plast.\</span>
<span id="cb10-1009"><a href="#cb10-1009" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The units of price (that in this example are multiplied by 1000) should be in the correct scale.\</span>
<span id="cb10-1010"><a href="#cb10-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1011"><a href="#cb10-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=TRUE, fold=TRUE}</span></span>
<span id="cb10-1012"><a href="#cb10-1012" aria-hidden="true" tabindex="-1"></a>stocks_newPrice <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"HKE"</span>, <span class="st">"ANK"</span>, <span class="st">"MEG"</span>, <span class="st">"MAC"</span>)</span>
<span id="cb10-1013"><a href="#cb10-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1014"><a href="#cb10-1014" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(stknp <span class="cf">in</span> stocks_newPrice){</span>
<span id="cb10-1015"><a href="#cb10-1015" aria-hidden="true" tabindex="-1"></a>  price_fm <span class="ot">&lt;-</span><span class="fu">read.xlsx</span>(<span class="st">'./input/Price_param_stk_flt_met_clean.xlsx'</span>, <span class="at">sheet =</span> stknp)</span>
<span id="cb10-1016"><a href="#cb10-1016" aria-hidden="true" tabindex="-1"></a>  flq <span class="ot">&lt;-</span> biols[[stknp]]<span class="sc">@</span>n</span>
<span id="cb10-1017"><a href="#cb10-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">units</span>(flq)<span class="ot">&lt;-</span> <span class="st">" "</span></span>
<span id="cb10-1018"><a href="#cb10-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1019"><a href="#cb10-1019" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(comf <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(price_fm)){</span>
<span id="cb10-1020"><a href="#cb10-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1021"><a href="#cb10-1021" aria-hidden="true" tabindex="-1"></a>    flnm <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"flnm"</span>]</span>
<span id="cb10-1022"><a href="#cb10-1022" aria-hidden="true" tabindex="-1"></a>    mtnm <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"mtnm"</span>]</span>
<span id="cb10-1023"><a href="#cb10-1023" aria-hidden="true" tabindex="-1"></a>    stnm <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"stnm"</span>]</span>
<span id="cb10-1024"><a href="#cb10-1024" aria-hidden="true" tabindex="-1"></a>    type <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"type"</span>]</span>
<span id="cb10-1025"><a href="#cb10-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1026"><a href="#cb10-1026" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (type <span class="sc">==</span> <span class="dv">5</span>){</span>
<span id="cb10-1027"><a href="#cb10-1027" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.min[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">"fixedPrice"</span></span>
<span id="cb10-1028"><a href="#cb10-1028" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.prev[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">"fixedPrice"</span></span>
<span id="cb10-1029"><a href="#cb10-1029" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.fixedEff[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">"fixedPrice"</span></span>
<span id="cb10-1030"><a href="#cb10-1030" aria-hidden="true" tabindex="-1"></a>      flq.elsa <span class="ot">&lt;-</span> flq</span>
<span id="cb10-1031"><a href="#cb10-1031" aria-hidden="true" tabindex="-1"></a>      flq.elsa[] <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"els"</span>]<span class="sc">*</span><span class="dv">1000</span> <span class="co"># in fixedPrice els is the price</span></span>
<span id="cb10-1032"><a href="#cb10-1032" aria-hidden="true" tabindex="-1"></a>      fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>price <span class="ot">&lt;-</span> flq.elsa[]</span>
<span id="cb10-1033"><a href="#cb10-1033" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb10-1034"><a href="#cb10-1034" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.min[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">'elasticPrice'</span></span>
<span id="cb10-1035"><a href="#cb10-1035" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.prev[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">'elasticPrice'</span></span>
<span id="cb10-1036"><a href="#cb10-1036" aria-hidden="true" tabindex="-1"></a>      fleets.ctrl.fixedEff[[flnm]][[mtnm]][[stknp]]<span class="sc">$</span>price.model <span class="ot">&lt;-</span> <span class="st">'elasticPrice'</span></span>
<span id="cb10-1037"><a href="#cb10-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1038"><a href="#cb10-1038" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parameters</span></span>
<span id="cb10-1039"><a href="#cb10-1039" aria-hidden="true" tabindex="-1"></a>    els <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"els"</span>]</span>
<span id="cb10-1040"><a href="#cb10-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1041"><a href="#cb10-1041" aria-hidden="true" tabindex="-1"></a>    P0 <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"P0"</span>]<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb10-1042"><a href="#cb10-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1043"><a href="#cb10-1043" aria-hidden="true" tabindex="-1"></a>    Plast <span class="ot">&lt;-</span> price_fm[comf, <span class="fu">colnames</span>(price_fm)<span class="sc">==</span> <span class="st">"Plast"</span>]<span class="sc">*</span><span class="dv">1000</span></span>
<span id="cb10-1044"><a href="#cb10-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1045"><a href="#cb10-1045" aria-hidden="true" tabindex="-1"></a>    La <span class="ot">&lt;-</span> fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>landings.n <span class="sc">*</span> fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>landings.wt</span>
<span id="cb10-1046"><a href="#cb10-1046" aria-hidden="true" tabindex="-1"></a>    La[<span class="fu">is.na</span>(La)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-1047"><a href="#cb10-1047" aria-hidden="true" tabindex="-1"></a>    row_sums_La <span class="ot">&lt;-</span> <span class="fu">quantSums</span>(La) <span class="co"># identify years with no landing data</span></span>
<span id="cb10-1048"><a href="#cb10-1048" aria-hidden="true" tabindex="-1"></a>    filtered_La <span class="ot">&lt;-</span> La[,row_sums_La <span class="sc">!=</span> <span class="dv">0</span>,,,,] <span class="co"># Remove years with no landing data</span></span>
<span id="cb10-1049"><a href="#cb10-1049" aria-hidden="true" tabindex="-1"></a>    La0 <span class="ot">&lt;-</span> filtered_La[, <span class="fu">min</span>(<span class="fu">dimnames</span>(filtered_La)<span class="sc">$</span>year)] <span class="co"># take the first landing year =! 0</span></span>
<span id="cb10-1050"><a href="#cb10-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1051"><a href="#cb10-1051" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format</span></span>
<span id="cb10-1052"><a href="#cb10-1052" aria-hidden="true" tabindex="-1"></a>    flq.elsa <span class="ot">&lt;-</span> flq.La0 <span class="ot">&lt;-</span> flq.Pa0 <span class="ot">&lt;-</span> flq.Plast <span class="ot">&lt;-</span> flq</span>
<span id="cb10-1053"><a href="#cb10-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1054"><a href="#cb10-1054" aria-hidden="true" tabindex="-1"></a>    flq.elsa[] <span class="ot">&lt;-</span> els</span>
<span id="cb10-1055"><a href="#cb10-1055" aria-hidden="true" tabindex="-1"></a>    flq.Pa0[]  <span class="ot">&lt;-</span> P0</span>
<span id="cb10-1056"><a href="#cb10-1056" aria-hidden="true" tabindex="-1"></a>    flq.La0[]  <span class="ot">&lt;-</span> La0</span>
<span id="cb10-1057"><a href="#cb10-1057" aria-hidden="true" tabindex="-1"></a>    flq.Plast[]  <span class="ot">&lt;-</span> Plast</span>
<span id="cb10-1058"><a href="#cb10-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1059"><a href="#cb10-1059" aria-hidden="true" tabindex="-1"></a>    fleets[[flnm]]<span class="sc">@</span>metiers[[mtnm]]<span class="sc">@</span>catches[[stnm]]<span class="sc">@</span>price <span class="ot">&lt;-</span> flq.Plast</span>
<span id="cb10-1060"><a href="#cb10-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1061"><a href="#cb10-1061" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.prev[[flnm]][[mtnm]][[stnm]][[<span class="st">'type'</span>]]   <span class="ot">&lt;-</span> type</span>
<span id="cb10-1062"><a href="#cb10-1062" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.elsa'</span>]] <span class="ot">&lt;-</span> flq.elsa</span>
<span id="cb10-1063"><a href="#cb10-1063" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.La0'</span>]] <span class="ot">&lt;-</span> flq.La0</span>
<span id="cb10-1064"><a href="#cb10-1064" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.Pa0'</span>]] <span class="ot">&lt;-</span> flq.Pa0</span>
<span id="cb10-1065"><a href="#cb10-1065" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'type'</span>]]   <span class="ot">&lt;-</span> type</span>
<span id="cb10-1066"><a href="#cb10-1066" aria-hidden="true" tabindex="-1"></a>    fleets.ctrl.min[[flnm]][[mtnm]][[stnm]][[<span class="st">'pd.total'</span>]] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb10-1067"><a href="#cb10-1067" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-1068"><a href="#cb10-1068" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-1069"><a href="#cb10-1069" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-1070"><a href="#cb10-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-1071"><a href="#cb10-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1072"><a href="#cb10-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">## REFERENCES</span></span>
<span id="cb10-1073"><a href="#cb10-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1074"><a href="#cb10-1074" aria-hidden="true" tabindex="-1"></a>*Salz, Pavel &amp; Buisman, Erik &amp; Frost, Hans &amp; Accadia, Paolo &amp; Prellezo, Raúl &amp; Soma, Katrine. (2011). FISHRENT; Bio-Economic simulation and optimisation model for fisheries*.</span>
<span id="cb10-1075"><a href="#cb10-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1076"><a href="#cb10-1076" aria-hidden="true" tabindex="-1"></a>*Kraak. 2004. An evaluation of MTAC – a program for the calculation of catch forecasts taking the mixed nature of the fisheries into account. Working Document at the ICES Working Group on Methods of Fish Stock Assessments, Lisbon, Portugal, 11-18 February 2004, ICES CM 2004/D:03.*</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="SEAWISE_FLBEIA_PriceDinamics_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>